WK5 sprint status (final)

Status (confirmed via agent logs)
- Agent 11 posted `wk5_r6`: ✅ all required gates PASS; ✅ snapshots captured; ✅ gallery rebuilt; ✅ Build B polish verified ready for signoff.
- Agent 03 posted `wk5_r6`: ✅ debris event emission + deterministic debris seeding confirmed (no Python hash()).

Sprint status
- WK5 is effectively **DONE**. The only remaining “work” is a **human manual live-play sanity check** (can’t be automated):
  - Watch Ranger/SkeletonArcher/Ballista fire and confirm projectiles are readable.
  - Destroy/demolish a building and confirm rubble remains.

Hotfix follow-up (player feedback)
- Rangers still *look melee* (they walk into point-blank before firing).
- Manual demolish shows *no visible debris* (likely too subtle at gameplay zoom).

Plan to troubleshoot + fix
- Ranger: confirm it’s a gameplay/range issue (not projectile pipeline). Fix by giving Rangers a proper ranged attack range and (optionally) a min-range/kite behavior similar to SkeletonArcher.
- Debris: confirm `building_destroyed` event emits on manual demolish (it should). Fix by making debris visually obvious at gameplay zoom:
  - include building footprint size in the event (w/h) so rubble scatters across the footprint, not a tiny center radius
  - increase piece size/count and contrast (2–3px, more pieces, add a darker “scorch/crumbled patch” underlay)
  - add a deterministic screenshot scenario `building_debris` so this never regresses silently.

Next prompt (send to only necessary agents)
Send to: Agent 03 (Architecture/Gameplay) + Agent 09 (Art/VFX). CC Agent 12 (Tools) and Agent 11 (QA) as-needed for scenario + verification.

PROMPT START
WK5 Hotfix — Ranger ranged readability + demolition debris visibility

Write your reply under:
`sprints["wk5-demolition-projectiles-workers"].rounds["wk5_r8"]`

Goal
- Rangers should *read as ranged*: they should fire from distance (not run into melee range), and the attack pose should match (bow cue).
- Manual demolish should leave clearly visible rubble at the former building footprint.

Constraints
- Determinism: no wall-clock dependencies; no Python `hash()` in deterministic seeds.
- Keep gates green: `python tools/qa_smoke.py --quick` and `python tools/validate_assets.py --strict --check-attribution`.

Agent 03 — Gameplay/Architecture (required)
1) Ranger ranged behavior
- Update `Hero` so `hero_class == "ranger"` has a proper ranged `attack_range` (recommend 5–7 tiles).
- Ensure AI movement respects this range (stop at range and fire; avoid point-blank unless forced).
- Optional (nice): introduce a small min-range/kite band similar to `SkeletonArcher` if it’s cheap.

2) Demolish debris visibility
- Confirm manual demolish path (`demolish_building` click → `_cleanup_destroyed_buildings(emit_messages=False)`) still emits `building_destroyed` events.
- Extend `building_destroyed` event payload to include footprint size:
  - `w`: building width in pixels
  - `h`: building height in pixels
  - (optional) `grid_w/grid_h` if that’s easier

Agent 09 — Art/VFX (required)
1) Ranger “bow shot” readability
- Ensure Ranger attack frame reads as bow usage at gameplay zoom (32×32). If the engine is falling back to procedural attack frames, adjust those to a bow cue for rangers (not sword arc).

2) Debris visuals
- Update debris rendering to use footprint size (if provided) and make it obvious:
  - scatter 10–25 pieces across the footprint
  - 2–3px chunks, higher contrast, add a subtle darker underlay patch
  - debris should persist (no fade-out)

Agent 12 — Tools (optional but recommended)
- Add `building_debris` screenshot scenario:
  - place a house, advance a few ticks, demolish it deterministically, capture post-demolish frame
- Add this scenario to the gallery run list (if appropriate).

Agent 11 — QA (optional)
- After fixes land: run gates + capture the new scenario(s) and rebuild gallery; confirm rubble + ranger ranged behavior in a quick manual check.

Reply with: PASS/FAIL + any issues observed + minimal repro steps.
PROMPT END


========================
WK6 sprint status (after wk6_r2)
========================

Status (confirmed via local repo + agent logs)
- ✅ `python tools/qa_smoke.py --quick` PASS (determinism guard + scenarios).
- ✅ Audio pipeline code exists: `game/audio/audio_system.py` + `game/audio/EVENT_CONTRACT.md`.
- ✅ Build menu list panel exists: `game/ui/building_list_panel.py` and engine wiring for click/hotkey parity.
- ✅ Rangers: exploration bias + black-fog bounty eligibility implemented (Agent 06).
- ✅ Fog: bounty rendering/pathing support + deterministic XP-for-reveal implemented (Agent 03).
- ⚠️ Assets: `assets/audio/sfx/` and `assets/audio/ambient/` are present but **empty**; `validate_assets --report` warns missing audio files.
- ⚠️ Audio naming mismatch to resolve:
  - Code/contract currently expects flat filenames like `assets/audio/sfx/building_place.wav` and `assets/audio/ambient/ambient_loop.ogg`.
  - Attribution + SoundDirector plan currently references nested files like `assets/audio/sfx/build/place.wav` and `assets/audio/ambient/day_loop.ogg`.

Sprint status
- WK6 feature work is **implemented**, but sprint is **NOT shippable yet** until we:
  - Align audio naming (contract + validator + attribution must agree), and
  - Add actual CC0/permissive audio files into `assets/audio/**`, and
  - Run snapshot captures for `bounty_in_black_fog` + `building_menu_open` and rebuild gallery.


Next prompt (send to only necessary agents)
Send to: Agent 03 (Architecture), Agent 12 (Tools/DevEx), Agent 14 (SoundDirector), Agent 11 (QA)
Do NOT send to: Agent 06, Agent 08 (implemented and gates pass; only re-engage if fixes needed).

PROMPT START
WK6 Finalization — wk6_r3 (ship gate)

Write your reply under:
`sprints["wk6-audio-buildmenu-fogbounties-explorexp"].rounds["wk6_r3"]`

Goal
- Make WK6 **shippable** by aligning the audio contract + validator + attribution, landing actual CC0 audio files, and producing the required deterministic screenshots.

Hard gates
- `python tools/qa_smoke.py --quick` must PASS.
- `python tools/validate_assets.py --report` must have **0 errors** (warns allowed for Build A, but try to eliminate warns if audio files are added).
- Snapshot capture commands must run successfully:
  - `python tools/capture_screenshots.py --scenario bounty_in_black_fog --seed 3 --out docs/screenshots/wk6_after/bounty_in_black_fog_seed3 --size 1920x1080 --ticks 0`
  - `python tools/capture_screenshots.py --scenario building_menu_open --seed 3 --out docs/screenshots/wk6_after/building_menu_open_seed3 --size 1920x1080 --ticks 0`

PM decisions (LOCKED)
- Tone: **cozy/peaceful (Majesty-like)**
- Ambient: **single neutral loop (Build A)**
- Variants: **Build B only** (multiple variants with deterministic selection)

Agent 03 — Architecture (required)
1) Wire in human-provided audio pack (KEEP current flat contract unless you have a strong reason to change it)
- Human-provided audio is in: `.cursor/human_provided/`
- Keep the current contract keys (from `game/audio/EVENT_CONTRACT.md` / `tools/assets_manifest.json`):
  - SFX: `building_place`, `building_destroy`, `bounty_place`, `bow_release`, `ui_click`
  - Ambient: `ambient_loop`
- IMPORTANT: most provided SFX are `.ogg`. Current `AudioSystem._load_sfx()` only tries `.wav`.
  - Update `AudioSystem` to load `.wav` OR `.ogg` for SFX (same behavior as validator).
  - Do NOT use wall-clock time; keep sim-time cooldown logic.

2) Ensure ambient actually plays (Build A)
- Pick a simple rule: start ambient loop on game start (or first tick) when audio enabled.

Agent 14 — SoundDirector_Audio (required)
0) Source of truth for the files
- Use the files already downloaded by the human in: `.cursor/human_provided/`

1) Pick initial SFX + ambient from `.cursor/human_provided/` and place into `assets/audio/**`
- Goal is “good enough to start”; we can iterate after playtest feedback.
- Put files here (flat contract):
  - `assets/audio/sfx/building_place.(ogg|wav)`
  - `assets/audio/sfx/building_destroy.(ogg|wav)`
  - `assets/audio/sfx/bounty_place.(ogg|wav)`
  - `assets/audio/sfx/bow_release.(ogg|wav)`
  - `assets/audio/sfx/ui_click.(ogg|wav)` (optional but recommended to eliminate validator warnings)
  - `assets/audio/ambient/ambient_loop.(ogg|wav)` (we already have a human-provided ambient `.wav`)
- Suggested starting picks (feel free to choose better ones):
  - `ui_click` = `kenney_ui-audio/Audio/click1.ogg` (or `mouseclick1.ogg`)
  - `building_place` = `open game art/wooden_01.ogg` (or a “switch” from Kenney)
  - `building_destroy` = `open game art/slam_07.ogg` (or `explosion.ogg` if you prefer louder)
  - `bounty_place` = `open game art/bell_01.ogg` (or `gong_01.ogg`)
  - `bow_release` = `open game art/spring_01.ogg` (twang-like) OR `shot_01.ogg` (placeholder)
  - `ambient_loop` = `game_ambient_loop/676787__neartheatmoshphere__blinking-forest-acoustic.wav`

2) Update attribution to match what we actually ship
- Update `assets/ATTRIBUTION.md` Audio Assets section so **file locations match the flat contract paths** above.
- Ensure `assets/audio/third_party/**` README notes reflect these sources (Kenney + OGA + Freesound file id for the ambient).

Agent 12 — Tools/DevEx (required)
1) Align `tools/assets_manifest.json` + `tools/validate_assets.py` with the final audio contract
- We are keeping the flat contract keys (building_place, building_destroy, bounty_place, bow_release, ui_click, ambient_loop).
- Once Agent 14 places files in `assets/audio/**`, `validate_assets --report` should go to **0 warns**.

2) Fix `building_menu_open` scenario apply-hook to open the new Build list panel
- Ensure it opens the correct panel (`building_list_panel`) implemented in WK6.

Agent 11 — QA (required)
1) Run verification suite after fixes land
- Re-run `qa_smoke --quick` and confirm PASS.
- Capture the two screenshots above and confirm visually:
  - bounty marker readable in black fog
  - build menu panel visible and readable
- Quick manual check (5 min): click Build → click a building row → place building → ESC cancels.

Reply format (all agents)
- Status: COMPLETE / IN_PROGRESS / BLOCKED
- Files changed
- Evidence (commands + outputs)
- Remaining risks (max 3)
PROMPT END


========================
WK6 sprint status (current)
========================

Status (confirmed via agent logs: wk6_r1)
- Agent 03 posted `wk6_r1`: ✅ Architecture contracts defined for AudioSystem (event-driven, non-authoritative), fog bounty/pathing (recommends direct steering fallback), and deterministic XP-for-reveal data flow.
- Agent 06 posted `wk6_r1`: ✅ AI behavior spec for Rangers: bias exploration toward black-fog “frontiers” + ensure black-fog bounties remain eligible; proposes tuning knobs + anti-thrash commitment window.
- Agent 08 posted `wk6_r1`: ✅ UX spec for clickable Build menu list panel; requires unified “select building” code path shared by hotkeys and clicks.
- Agent 12 posted `wk6_r1`: ✅ Tools specs for audio asset validation + new snapshot scenarios (bounty_in_black_fog, building_menu_open); marked “awaiting dependencies” (audio naming + event contracts).
- Agent 14 posted `wk6_r1`: ✅ Sound map + CC0 sourcing plan + folder structure + mixing/cooldown guidance; asks PM preference on tone/day-night/variants.
- Agent 11 posted `wk6_r1`: ✅ QA checklist + suggested minimal deterministic checks; no code changes yet.

Sprint status
- WK6 is **READY FOR IMPLEMENTATION (wk6_r2)**. All Round-1 specs are in; no hard blockers.
- Primary dependency ordering:
  - Lock audio naming + event names (03 + 14) → enables asset manifest/validator work (12) and engine integration (03).
  - Implement Build menu list + unified selection path (08 + 03).
  - Implement black-fog bounty targeting/pathing + Ranger exploration bias + deterministic XP (03 + 06).
  - Then QA verification + snapshots (11 + 12).

PM decision needed (to unblock audio asset finalization)
- Tone preference: **cozy/peaceful (Majesty-like)**.
- Ambient: **single neutral loop (Build A)**.
- Variants: **multiple variants with deterministic selection (Build B)** (Build A ships single file per event).


Next prompt (send to only necessary agents)
Send to: Agent 03 (Architecture), Agent 06 (AI), Agent 08 (UX/UI), Agent 12 (Tools), Agent 14 (Sound)
Do NOT send to: Agent 11 (QA) yet (they can wait until implementation lands; we’ll ping them for verification later).

PROMPT START
WK6 Implementation Kickoff — wk6_r2 (Build A focus)

Write your reply under:
`sprints["wk6-audio-buildmenu-fogbounties-explorexp"].rounds["wk6_r2"]`

Context files (keep in your working set):
- `.cursor/plans/wk6_ranged_update+_dee12351.plan.md`
- `.cursor/plans/ai_studio_infrastructure_progress.md`
- `.cursor/plans/studio-agent-cards_c3880ea5.plan.md`

Sprint goal (Build A)
- Audio: Event-driven, non-authoritative `AudioSystem` with CC0/permissive SFX + ambient; safe when disabled/mixer missing.
- UI: Clicking **Build** opens a clickable building list; clicking a row behaves exactly like the hotkey (unified selection path).
- Fog: Bounties must be visible even in solid black fog; Rangers must respond/path to those bounties even when unrevealed/far.
- Rangers: More likely to explore black fog; gain deterministic XP for newly revealed black fog tiles.

Global constraints
- Determinism: no wall-clock dependencies; no Python `hash()` for deterministic selection.
- Keep gates green: `python tools/qa_smoke.py --quick` and `python tools/validate_assets.py --strict --check-attribution`.
- Audio must never affect simulation outcomes (pure consumer).

Agent 03 — Architecture/Integration (required)
1) Lock audio event contract + naming (today)
- Confirm final event `type` names used for audio triggers (use your wk6_r1 contract).
- Publish the canonical list (event name → logical sound key) so Agent 14 and Agent 12 can align file naming + manifest.

2) Implement `AudioSystem` skeleton + engine wiring (Build A)
- Create `game/audio/audio_system.py` (safe mixer init, preload SFX, cooldowns, ambient loop).
- Wire into `game/engine.py` similarly to VFX: consume emitted events and trigger sound.
- Ensure safe no-op behavior if audio disabled or mixer init fails.

3) Fog bounty support (Build A)
- Ensure bounty markers render even when tile is `Visibility.UNSEEN` (solid black).
- Ensure Rangers can pursue bounties in black fog:
  - Prefer your recommended approach: direct steering toward far unrevealed targets, switching to normal pathing when near/revealed.

4) Deterministic XP-for-reveal (Build A)
- Add per-Ranger revealed tile tracking + XP awards for newly revealed tiles (idempotent/deterministic).

Agent 06 — AI Behavior (required)
1) Implement Ranger black-fog exploration bias
- Add deterministic frontier-target selection (UNSEEN tiles adjacent to SEEN/VISIBLE) with bounded scan radius.
- Add commitment window to prevent thrash.
- Add tuning knobs in `config.py` (as in your wk6_r1 spec) with sensible defaults.

2) Ensure bounty targeting does not exclude black-fog bounties
- Remove any visibility-based filtering in bounty selection/scoring.
- If needed, add a small black-fog distance penalty (but never exclusion).

Agent 08 — UX/UI (required)
1) Implement Build menu list panel (Build A)
- Add clickable panel listing buildings (icon/name/cost/hotkey).
- Close rules: ESC, click outside, Build button toggles closed; selecting building closes panel and enters placement mode.
- Unavailable rows are grayed and non-clickable (cannot afford / prerequisites / conflicts).

2) Enforce click/hotkey parity
- Coordinate with Agent 03 on a single unified method like `select_building_for_placement(building_type)` and route both hotkeys + clicks through it.

Agent 12 — Tools/DevEx (required, but after audio naming is locked)
1) Audio asset validation
- Add `audio` section to `tools/assets_manifest.json` and validate `assets/audio/**` exists and attribution is present (reuse existing attribution checks).
- Decide strictness: for Build A, OK to warn-only if missing; for Build B, make missing audio a strict failure (but follow repo conventions).

2) Snapshot scenarios (Build A)
- Add `bounty_in_black_fog` and `building_menu_open` scenarios to `tools/screenshot_scenarios.py`.
- Register scenarios; ensure determinism; ensure captures work headless.

Agent 14 — SoundDirector_Audio (required)
1) Finalize Build A audio pack + naming aligned to Agent 03 contract
- Provide final file list (exact filenames + folders) that match the sound map keys.
- Keep Build A minimal: one file per event is acceptable; no variants unless you can define deterministic selection rules.

2) Attribution + third_party proof
- Update `assets/ATTRIBUTION.md` with audio section, and include `assets/audio/third_party/**` license/README proof files.

3) Confirm 3 PM choices (reply with your recommendation, or ask for final decision)
- Tone: **cozy/peaceful (Majesty-like)** (locked).
- Ambient: **single neutral loop (Build A)** (locked).
- Variants: **multiple variants with deterministic selection (Build B)** (locked; for Build A, ship single files per event).

Reply format (all agents)
- Status: COMPLETE / IN_PROGRESS / BLOCKED
- What you changed (files + key behaviors)
- Evidence: commands run + results
- Any risks/edge cases you want QA to target
PROMPT END