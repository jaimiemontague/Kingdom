{
  "schema_version": "2.0",
  "agent": { "id": "08", "name": "UX_UI_Director" },
  "notes": [
    "This file is owned by Agent 08 only.",
    "Structure nests rounds inside sprints to keep history organized."
  ],
  "sprints": {
    "wk1-broad-sweep-midweek-endweek": {
      "sprint_meta": {
        "plan_ref": ".cursor/plans/wk1-broad-sweep-midweek-endweek_3ca65814.plan.md",
        "notes": ""
      },
      "rounds": {
        "wk1_r1": {
          "sprint_id": "wk1-broad-sweep-midweek-endweek",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk1-broad-sweep-midweek-endweek_3ca65814.plan.md",
            "notes": ""
          },
          "round_id": "wk1_r1",
          "round_meta": {
            "prompt_set_id": "wk1_prompts_v1",
            "build_target": "BuildA_midweek+BuildB_endweek",
            "sent_at_local": "2025-12-20T20:19:25.967479-07:00"
          },
          "prompt_text": "Write UI copy and layout for hero intent/last decision and bounty responders/attractiveness; keep it readable and non-spammy.",
          "response": {
            "received_at_local": "2025-12-20T20:19:25.967479-07:00",
            "status": "complete",
            "raw": "### Status\n**Assignment:** WK1 R1 — UX/UI clarity (Agent 8: UX_UI_Director). Deliver UI copy + layout rules for **hero intent/last decision** and **bounty responders/attractiveness**, kept readable and non-spammy, and safe in mock/no-LLM.\n\n### Deliverables\n- **Hero inspect UI (FS-1)**:\n  - Show **Current intent** (single, stable label).\n  - Show **Last decision** (action + short reason + age), with safe placeholder if none yet.\n  - Must work in **LLM + mock + no-LLM**.\n- **Bounty legibility UI (FS-2)**:\n  - Each bounty displays **Responders: N**.\n  - Each bounty displays **Attractiveness: Low/Med/High** (or compact icon/text).\n  - Deterministic computation; no extra LLM calls.\n- **Low-risk HUD clarity**:\n  - Reduce always-on “wall of controls” via **toggleable help**.\n  - Show a small **mode banner** when placing a building.\n\n### Proposed UI copy (player-facing)\n- **Hero panel**\n  - `Intent: <Idle | Moving | Engaging enemy | Pursuing bounty | Shopping | Returning to safety | Resting>`\n  - `Last decision: <action> → <target> (<age>s ago) — <short reason>`\n  - Placeholder: `Last decision: (none yet)`\n  - Notes:\n    - Keep reason to ~1 short clause, truncate with ellipsis if needed.\n    - “Age” should be based on **sim-time** (tick/sim clock), not wall-clock.\n\n- **Bounty marker**\n  - `R:<N>  <Low|Med|High>`\n  - Optional expanded tooltip later: `Responders: N` / `Attractiveness: <tier>`\n\n- **Placement mode banner**\n  - `Placing: <Building Name> (LMB: place, ESC: cancel)`\n\n- **Help toggle hint**\n  - When hidden: `F3: Help`\n  - Header: `Controls (F3 to hide)`\n\n### UI layout rules (readability)\n- **Prioritize “now” info**:\n  - Always-visible: gold / counts / wave + small mode banner when applicable.\n  - On-demand: the full control list (help overlay).\n- **Avoid spam**:\n  - Toast messages should be short and non-repeating.\n  - Prefer persistent labels for state (intent/banner) over repeated popups.\n- **Truncation/overflow**:\n  - Never overflow panels; truncate long reasoning lines.\n  - Keep bounty labels compact; avoid multi-line text in world space.\n- **Color semantics**\n  - Attractiveness tiers: Low=gray, Med=gold, High=green.\n  - Keep text readable over fog-of-war; use high contrast.\n\n### Acceptance criteria (for UX slice)\n- Selecting a hero shows **Intent** and **Last decision** (or safe placeholder).\n- Last decision shows **age** derived from sim-time (or blank if unavailable).\n- Each bounty shows **Responders** and **Attractiveness tier**.\n- No crashes if hero has no decision yet / no heroes exist / no bounties exist.\n- UI additions do not allocate heavily per frame (keep text generation lightweight).\n\n### Risks\n- **Mismatch between UI “intent” and future intent taxonomy**: mitigate by keeping labels stable and mapping from real fields when they exist.\n- **Perf regression** from per-frame string work: mitigate by keeping computations lightweight and capped; avoid per-frame allocations where possible.\n- **Visual clutter** if too much overlay text: keep bounty markers compact and help toggleable.\n\n### Dependencies / coordination notes\n- **Agent 3 (Architecture)**: eventual stable contract for `hero.intent` and `hero.last_decision` will replace UI-side inference.\n- **Agent 6 (AIBehaviorDirector_LLM)**: align naming for intent labels and ensure “reason” strings stay short.\n- **Agent 9 (Art/VFX)**: optional iconography for attractiveness tiers; must remain readable over fog-of-war.\n\n### Questions back to PM (max 3)\n- Should help overlay default to **ON** for Build A to support onboarding, or **OFF** to reduce clutter?\n- Should attractiveness reflect **global** risk/reward or be **class-aware** (align with AI scoring) in future?\n- Any preferred copy tone: more “Majesty-like” flavor or strictly utilitarian labels for now?\n\n### Recommended next actions\n- Hook future `hero.intent`/`hero.last_decision` contract into UI when available (remove inference).\n- Add hover tooltips for bounty markers (optional) and/or a tiny legend for Low/Med/High.\n- Add a “bounty placement mode” (toggle B, click to place, ESC cancel) if misfires become common.\n",
            "summary_bullets": [
              "Hero inspect: show Intent + Last decision (action/target/reason/age) with safe placeholder.",
              "Bounties: show responders count and attractiveness tier (Low/Med/High) deterministically.",
              "HUD clarity: keep always-on HUD minimal; put full controls behind a toggle; show placement-mode banner.",
              "Keep UI non-spammy with truncation and compact world-space labels."
            ],
            "proposed_changes": [
              "Hero panel adds: Intent line + Last decision line (action/target/reason/age).",
              "Bounty marker adds: responders count (R:N) and attractiveness tier (Low/Med/High).",
              "Add help overlay toggle and make controls on-demand.",
              "Add placement mode banner: \"Placing: <Building> (LMB: place, ESC: cancel)\".",
              "Enforce truncation/overflow rules to prevent UI overlap."
            ],
            "acceptance_criteria": [
              "Selecting a hero shows Intent and Last decision; if no decision exists, show neutral placeholder without errors.",
              "Decision age uses sim-time or tick-based time; safe if unavailable.",
              "Each bounty shows responders (0..N) and attractiveness tier; safe with 0 heroes or 0 bounties.",
              "UI remains readable: compact bounty labels; no panel overflow; help overlay optional.",
              "No noticeable per-frame allocation spikes from UI text generation."
            ],
            "risks": [
              "Intent labels could drift from a future standardized taxonomy; mitigate by mapping to hero.intent when available.",
              "Per-frame computation/text could cause perf regressions if expanded; mitigate by caching UI surfaces/strings and throttling UI-metric recompute.",
              "Overlay clutter near bounties; keep labels compact and avoid multi-line world text."
            ],
            "dependencies": [
              "Agent 3: stable data contract for hero intent + last decision (eventually replace UI inference).",
              "Agent 6: align intent taxonomy + keep reason strings short/consistent across providers.",
              "Agent 9 (optional): readability guidance/icons for attractiveness tiers over fog-of-war."
            ],
            "questions_back_to_pm": [
              "ACK (PM wk1_r1): help overlay default OFF + persistent 'F3: Help' hint; global attractiveness tier. ETA: same-day for caching pass. Blockers: none."
            ],
            "recommended_next_actions": [
              "Implement PM ask: default help overlay OFF; keep persistent 'F3: Help' hint when hidden.",
              "Implement PM ask: eliminate per-frame allocations by caching help panel surface and caching bounty label text surfaces; throttle UI-metric recompute cadence.",
              "Re-run `py_compile`/smoke and keep the UI changes isolated to UI modules only."
            ],
            "agent_fields": {
              "pm_acknowledged": true,
              "ui_copy": [
                "Intent: <Idle | Moving | Engaging enemy | Pursuing bounty | Shopping | Returning to safety | Resting>",
                "Last decision: <action> → <target> (<age>s ago) — <short reason>",
                "Last decision placeholder: (none yet)",
                "Bounty label: R:<N>  <Low|Med|High>",
                "Placement banner: Placing: <Building> (LMB: place, ESC: cancel)",
                "Help hint: F3: Help / Controls (F3 to hide)"
              ],
              "ui_layout_rules": [
                "Keep always-on HUD minimal; put full controls behind a toggle.",
                "Prefer persistent state labels (intent/banner) over repeated toast spam.",
                "Truncate long reasoning; never overflow panels.",
                "Use compact world-space bounty labels; avoid multi-line text on the map.",
                "Tier color semantics: Low=gray, Med=gold, High=green; maintain contrast over fog-of-war."
              ],
              "ux_acceptance_criteria": [
                "Player can answer \"what is this hero doing and why\" by selecting a hero.",
                "Bounties clearly show who is responding and how attractive they are.",
                "All new UI degrades gracefully with missing data (no exceptions).",
                "Decision age uses sim-time/ticks (not wall-clock) when available."
              ]
            }
          }
        },
        "wk1_r2": {
          "sprint_id": "wk1-broad-sweep-midweek-endweek",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk1-broad-sweep-midweek-endweek_3ca65814.plan.md",
            "notes": ""
          },
          "round_id": "wk1_r2",
          "round_meta": {
            "prompt_set_id": "wk1_final_changes_v1",
            "build_target": "BuildA_midweek",
            "sent_at_local": "2025-12-20T21:10:03.927477-07:00"
          },
          "prompt_text": "WK1 Final Changes Round (wk1_r2): If you are Agent 08: complete WK1-BUG-001 and WK1-BUG-002. Gate: python tools/qa_smoke.py --quick must PASS.",
          "response": {
            "received_at_local": "2025-12-20T21:10:03.927477-07:00",
            "status": "complete",
            "raw": "### Status\\nCompleted WK1-BUG-001 + WK1-BUG-002 (Agent 08) for Build A final changes.\\n\\n### What changed (bugfixes)\\n- **WK1-BUG-001** (no-LLM hero panel): HUD now prefers the hero contract snapshot (`hero.get_intent_snapshot()` / `hero.last_decision`) so **Last decision** populates in `--no-llm` (not LLM-only fields).\\n- **WK1-BUG-002** (bounty placement discoverability): Help overlay copy explicitly explains **B places a bounty at the mouse cursor** and that **Shift/Ctrl** place larger bounties (tiered rewards). Added a short early-session on-screen hint (non-spammy, time-limited) when no bounties exist.\\n\\n### Files changed\\n- `game/ui/hud.py`\\n- `game/systems/bounty.py` (minor responder-field robustness to satisfy QA gate; keeps responder_count >0 once a bounty is explicitly taken)\\n\\n### How to test\\n- Manual (no-LLM):\\n  - `python main.py --no-llm`\\n  - Wait ~30–90s, select a hero → **Last decision** should not stay `(none yet)` for at least one hero.\\n  - Press **F3** → help overlay shows bounty instructions.\\n  - Move mouse over ground and press **B** (Shift/Ctrl optional) → bounty appears at cursor and gold decreases.\\n- Gate: `python tools/qa_smoke.py --quick`\\n\\n### Evidence\\n`python tools/qa_smoke.py --quick` => PASS\\n- `[determinism_guard] PASS: no violations found`\\n- `[qa_smoke] DONE: PASS`\\n",
            "summary_bullets": [
              "Fixed hero panel Last decision in --no-llm by reading hero intent/decision contract snapshot (not LLM-only fields).",
              "Made bounty placement discoverable: explicit help overlay copy + early on-screen hint; mentions Shift/Ctrl tiers (since tiers ship).",
              "Kept QA gate green: `python tools/qa_smoke.py --quick` PASS."
            ],
            "proposed_changes": [
              "HUD uses `hero.get_intent_snapshot()` to populate intent + last decision (action/reason/age) across LLM and no-LLM.",
              "Help overlay: clarify 'B places bounty at mouse' and list Shift/Ctrl tier modifiers.",
              "Early-session hint: show one short bounty placement hint until first bounty or timeout."
            ],
            "acceptance_criteria": [
              "In `python main.py --no-llm`, at least one hero shows a non-empty Last decision after 30–90s.",
              "Help overlay (F3) clearly explains bounty placement behavior and tier modifiers.",
              "`python tools/qa_smoke.py --quick` PASS."
            ],
            "risks": [
              "Extra on-screen hint could add clutter; mitigated by time limit + only shown when no bounties exist.",
              "Responder tracking fields are consumed by QA; ensure they remain deterministic and lightweight."
            ],
            "dependencies": [
              "Hero contract snapshot (`hero.get_intent_snapshot()` / `hero.last_decision`) must remain stable (Agent 03/06)."
            ],
            "questions_back_to_pm": [],
            "recommended_next_actions": [
              "Optional: add small UX affordance for bounty placement mode (toggle B then click) if misfires remain a playtest complaint.",
              "Optional: add hover tooltip for bounties with full 'Responders: N' + tier text if readability issues persist."
            ],
            "agent_fields": {
              "pm_acknowledged": true,
              "files_changed": [
                "game/ui/hud.py",
                "game/systems/bounty.py"
              ],
              "qa_smoke_evidence": [
                "[determinism_guard] PASS: no violations found",
                "[qa_smoke] DONE: PASS"
              ]
            }
          }
        }
      }
    }
    ,
    "wk2-hero-polish-ai-sprites": {
      "sprint_meta": {
        "plan_ref": ".cursor/plans/wk2-hero-polish-ai-sprites_5318e148.plan.md",
        "notes": "WK2 kickoff: Agent 08 focuses on minimal debug visibility + readability for stuck/inside-combat/animation state."
      },
      "rounds": {
        "wk2_r1": {
          "sprint_id": "wk2-hero-polish-ai-sprites",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk2-hero-polish-ai-sprites_5318e148.plan.md",
            "notes": ""
          },
          "round_id": "wk2_r1",
          "round_meta": {
            "prompt_set_id": "wk2_kickoff_v1",
            "build_target": "BuildA_midweek+BuildB_endweek",
            "sent_at_local": "2025-12-20T21:59:09.250207-07:00"
          },
          "prompt_text": "WK2 Kickoff (Round 1 / wk2_r1) — Agent 8: propose minimal debug visibility for stuck/unstuck (debug-only) and ensure animations/readability align with intent. Keep UI changes lightweight and avoid per-frame allocations. Wait for Agent 3 contract surface before contract-dependent changes.",
          "response": {
            "received_at_local": "2025-12-20T21:59:09.250207-07:00",
            "status": "complete",
            "raw": "### Status\\nWK2 R1 (async meeting stage): Agent 08 is active. I am proposing the smallest UI/UX additions needed to make hero behavior fixes (anti-oscillation, stuck recovery, no-combat-inside) **visible and debuggable** without a UI rework, and to ensure the new sprite states read as intent.\\n\\n### Deliverables (R1 output)\\n- UX acceptance criteria for: inside-combat gating readability, stuck/unstuck visibility, animation-state readability.\\n- Implementation plan with file boundaries (HUD + optional debug panel only).\\n- Deterministic-friendly display rules (sim-time-based ages; no wall-clock dependence for sim-relevant UI).\\n\\n### Proposed changes (Build A vs Build B)\\n**Build A (Midweek): visibility + debug-only indicators**\\n- Add a **stuck indicator** to selected-hero panel (debug-only): stuck_reason + unstuck_attempts + time stuck (sim-time).\\n- Add a lightweight **one-line debug toast** when an unstuck event triggers (debug-only; rate-limited).\\n- Ensure \"inside building\" state is always visually explainable (panel shows 'Inside: <building>' or 'Inside: yes').\\n\\n**Build B (Endweek): polish/readability + sprites**\\n- Verify sprite states map cleanly to intent: idle/walk/attack/hurt/inside are visually distinct; no jittery toggles.\\n- Optional: small 'inside' badge/icon near hero when selected (debug-only or always-on if Agent 2 approves).\\n\\n### File boundaries (my domain only)\\n- `game/ui/hud.py`\\n  - Selected-hero panel: add stuck/inside labels (behind debug flag/condition).\\n  - Debug-only toast for unstuck events (optional; uses existing HUD messages with throttle).\\n- `game/ui/debug_panel.py` (optional)\\n  - Add compact stuck counters and the last stuck_reason per selected hero for developers.\\n- **No AI/nav/path changes**; I will only read fields defined by Agent 3’s contract surface.\\n\\n### Acceptance criteria (UX)\\n- **No-combat-inside readability**: When a hero is inside a building, UI makes it obvious (panel shows inside status/building), and the hero does not show \"attacking\" while inside.\\n- **Stuck visibility**: If stuck recovery triggers in the repro scenario, the selected hero panel shows stuck_reason + attempts (debug-only) and a single toast appears (debug-only).\\n- **Non-spammy**: No repeated toasts every frame; all debug notices are rate-limited.\\n- **Determinism guardrails**: Any displayed durations use sim-time/ticks (not wall-clock).\\n\\n### Exact test commands (expected to be added/extended by Agents 11/12)\\n- Gate: `python tools/qa_smoke.py --quick`\\n- Deterministic repro: `python tools/observe_sync.py --seconds 20 --scenario hero_stuck_repro --qa --seed <N>` (exact scenario name pending Agent 12).\\n- Manual: `python main.py --no-llm` and `python main.py --provider mock` (10 min smoke): observe no attacks while inside buildings; observe unstuck events are visible in debug mode.\\n\\n### Risks (blockers only)\\n- Blocker risk: UI field names may change; must wait for Agent 3 contract surface (stuck_reason/attempt counters/inside gating signal).\\n\\n### Dependencies\\n- **Agent 3**: define final contract fields for stuck detection and inside-combat gating visibility (field names + meaning).\\n- **Agent 11/12**: provide deterministic repro scenario and QA assertions so UI indicators can be validated without flake.\\n\\n### Next actions\\n- Wait for Agent 3’s posted contract surface for: `stuck_reason`, `unstuck_attempts`, and any `can_attack`/inside-combat gating signal.\\n- Once contracts land: implement minimal HUD additions (selected hero panel) and keep them debug-only by default.\\n",
            "summary_bullets": [
              "Build A: minimal debug visibility for stuck/unstuck + inside-building state in the selected hero panel (debug-only, rate-limited).",
              "Build B: verify sprite state readability (idle/walk/attack/hurt/inside) aligns with intent; optional inside badge if approved.",
              "No AI/nav changes; UI will only read Agent 3 contract fields (wait rule enforced)."
            ],
            "proposed_changes": [
              "Add stuck indicators (reason/attempts/time stuck) to selected hero panel behind debug flag/condition.",
              "Add debug-only rate-limited toast when an unstuck event triggers.",
              "Expose inside-building state clearly in hero panel to support no-combat-inside acceptance criteria.",
              "Optional: add stuck info to DebugPanel for developer triage."
            ],
            "acceptance_criteria": [
              "Heroes never appear to attack while inside buildings; UI clearly indicates inside status when applicable.",
              "In deterministic stuck repro scenario, unstuck triggers are visible via debug-only UI (panel indicator + single toast).",
              "All debug UI is rate-limited and does not spam per-frame.",
              "All elapsed-time displays use sim-time/ticks (no wall-clock reliance).",
              "`python tools/qa_smoke.py --quick` remains PASS."
            ],
            "risks": [
              "Contract-dependent fields may shift; UI work must wait for Agent 3 contract surface to avoid schema drift.",
              "Debug visibility could clutter HUD if not gated; keep debug-only by default."
            ],
            "dependencies": [
              "Agent 3: contract surface for stuck_reason/unstuck_attempts/can_attack gating signals.",
              "Agent 12: deterministic headless repro scenario (hero_stuck_repro) with seed and outputs.",
              "Agent 11: QA assertions integrated into qa_smoke to validate stuck recovery + inside-combat gating."
            ],
            "questions_back_to_pm": [
              "Blocker question: should stuck/unstuck indicators be debug-only (recommended) or player-facing in Build A?"
            ],
            "recommended_next_actions": [
              "After Agent 3 posts contracts, implement the minimal HUD/DebugPanel reads with caching (avoid per-frame allocations).",
              "Coordinate with Agent 11/12 on which scenario/seed to use for validating stuck indicators.",
              "After Agent 9 sprite drop, do a readability pass to ensure inside/attack/hurt frames are unmistakable at 32x32."
            ],
            "agent_fields": {
              "ui_copy": [
                "Debug: STUCK (<reason>) attempts=<n> for <t>s",
                "Inside: <building_type> / Inside: yes"
              ],
              "ui_layout_rules": [
                "Debug-only indicators must be gated and rate-limited.",
                "Never allocate new Surfaces per frame; cache text surfaces where possible.",
                "Use sim-time/ticks for durations displayed in UI."
              ],
              "ux_acceptance_criteria": [
                "Debug UI makes it obvious when stuck recovery triggers and why.",
                "Inside-building state is always clear to prevent combat-while-inside confusion.",
                "Animation states are readable and do not jitter between states."
              ],
              "wait_for_agent3_contracts": true
            }
          }
        }
        ,
        "wk2_r2": {
          "sprint_id": "wk2-hero-polish-ai-sprites",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk2-hero-polish-ai-sprites_5318e148.plan.md",
            "notes": ""
          },
          "round_id": "wk2_r2",
          "round_meta": {
            "prompt_set_id": "wk2_exec_r2_v1",
            "build_target": "BuildA_midweek",
            "sent_at_local": "2025-12-20T22:09:53.426958-07:00"
          },
          "prompt_text": "WK2 Round 2 (wk2_r2) — Execute Build A focus. Agent 08: implement minimal debug-only UI reads for inside status + stuck snapshot using locked contracts; keep cache-friendly; ensure `python tools/qa_smoke.py --quick` PASS.",
          "response": {
            "received_at_local": "2025-12-20T22:09:53.426958-07:00",
            "status": "complete",
            "raw": "### Status\\nWK2 R2 execution complete for Agent 08: added debug-only HUD visibility for inside-building state, stuck snapshot, and attack-gating surface (contract fields only).\\n\\n### What changed\\n- **Debug-only HUD indicators (selected hero panel)**\\n  - Reads locked contract fields:\\n    - `hero.get_stuck_snapshot(now_ms)` (expects dict with `stuck_active`, `stuck_since_ms`, `unstuck_attempts`, `stuck_reason`)\\n    - `hero.can_attack` + optional `hero.attack_blocked_reason`\\n  - Shows \"Inside: <building>\" when `hero.is_inside_building` is true (player-facing only when inside; otherwise hidden).\\n  - Indicators are gated behind `debug_ui` so they appear only when the debug panel is visible.\\n- **Cache-friendly**\\n  - Added small text-surface caching for debug lines to avoid per-frame allocations.\\n- **Plumbing**\\n  - Added `debug_ui` boolean into `game_state` so HUD can reliably gate debug-only indicators based on `DebugPanel.visible`.\\n\\n### Files changed\\n- `game/ui/hud.py`\\n- `game/engine.py`\\n\\n### Test commands run (evidence)\\n- `python tools/qa_smoke.py --quick` => PASS\\n  - `[determinism_guard] PASS: no violations found`\\n  - `[qa_smoke] DONE: PASS`\\n\\n### Manual smoke (required by sprint)\\n- Commands (not run here due to interactive window):\\n  - `python main.py --no-llm`\\n  - `python main.py --provider mock`\\n  - Open debug panel (F1), select hero, verify debug-only stuck/atk-block indicators appear when applicable.\\n",
            "summary_bullets": [
              "HUD now shows debug-only stuck snapshot + attack-block reason using locked contract fields (no AI imports).",
              "Inside-building state is visible in selected hero panel when applicable (reduces confusion about inside-combat gating).",
              "Added `debug_ui` flag to game_state so HUD can gate debug-only indicators based on DebugPanel visibility.",
              "`python tools/qa_smoke.py --quick` PASS."
            ],
            "proposed_changes": [
              "Add `debug_ui` to `GameEngine.get_game_state()` based on `DebugPanel.visible`.",
              "In HUD selected-hero panel: show Inside status; if debug_ui is true, show stuck snapshot + ATK BLOCKED details.",
              "Cache debug text surfaces to avoid per-frame Surface churn."
            ],
            "acceptance_criteria": [
              "When DebugPanel is visible, selecting a hero shows stuck snapshot (if stuck_active) and attack blocked details (if can_attack=False).",
              "When hero is inside a building, selected hero panel shows Inside status; otherwise does not add clutter.",
              "No contract guessing: only reads `get_stuck_snapshot`, `can_attack`, `attack_blocked_reason` (safe if absent).",
              "`python tools/qa_smoke.py --quick` PASS."
            ],
            "risks": [
              "If Agent 6/3 contract fields aren’t present yet in a branch, debug indicators will silently not show; mitigated by safe hasattr/try blocks.",
              "Text caching could grow unbounded; mitigated by a small cache size cap/clear."
            ],
            "dependencies": [
              "Agent 6/3 must implement the locked Hero fields and `get_stuck_snapshot` semantics for full usefulness.",
              "Agent 11/12 deterministic repro scenarios will be needed to reliably observe stuck indicators."
            ],
            "questions_back_to_pm": [],
            "recommended_next_actions": [
              "Once Tools/QA land `hero_stuck_repro`, validate debug indicators in that scenario (debug panel open).",
              "If debug UI needs a non-interactive toggle for CI screenshots, coordinate with Agent 12 (optional)."
            ],
            "agent_fields": {
              "pm_acknowledged": true,
              "files_changed": [
                "game/ui/hud.py",
                "game/engine.py"
              ],
              "test_commands_run": [
                "python tools/qa_smoke.py --quick"
              ],
              "test_evidence": [
                "[determinism_guard] PASS: no violations found",
                "[qa_smoke] DONE: PASS"
              ],
              "blockers": []
            }
          }
        }
        ,
        "wk2_r3": {
          "sprint_id": "wk2-hero-polish-ai-sprites",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk2-hero-polish-ai-sprites_5318e148.plan.md",
            "notes": ""
          },
          "round_id": "wk2_r3",
          "round_meta": {
            "prompt_set_id": "wk2_wrap_r3_v1",
            "build_target": "BuildA_midweek",
            "sent_at_local": "2025-12-20T22:36:46.194190-07:00"
          },
          "prompt_text": "WK2 Round 3 (wk2_r3) — Final sync + blockers only (Build A readiness). Agents 08+09: coordinate HUD integration to preserve Agent 09 HUD init crash fix (messages init) and Agent 08 debug-only stuck/inside indicators + caching + debug_ui gating. Rerun `python tools/qa_smoke.py --quick` and include PASS evidence.",
          "response": {
            "received_at_local": "2025-12-20T22:36:46.194190-07:00",
            "status": "complete",
            "raw": "### Status\\nWK2 R3 final sync: confirmed `game/ui/hud.py` contains BOTH Agent 09's HUD init crash fix and Agent 08's debug-only stuck/inside indicator + caching + debug gating, and re-ran the mandatory gate successfully.\\n\\n### Integration check (HUD)\\n- **Preserved Agent 09 crash fix**: `HUD.__init__` initializes `self.messages` and `self.message_duration` (prevents crash during manual smoke when HUD message methods are called).\\n- **Preserved Agent 08 features**: debug-only stuck/inside indicators, `debug_ui` gating (via `game_state['debug_ui']`), and cache-friendly line rendering.\\n\\n### Gate evidence\\n- `python tools/qa_smoke.py --quick` => PASS\\n  - `[determinism_guard] PASS: no violations found`\\n  - `[qa_smoke] DONE: PASS`\\n\\n### Files involved\\n- `game/ui/hud.py` (merged crash fix + debug-only indicators + caching)\\n- `game/engine.py` (provides `debug_ui` in game_state for gating)\\n\\n### Blockers\\nNone.\\n",
            "summary_bullets": [
              "HUD integration preserved: messages init crash fix + debug-only stuck/inside indicators + caching + debug_ui gating.",
              "Mandatory gate re-run: `python tools/qa_smoke.py --quick` PASS (determinism_guard PASS).",
              "No blockers for Build A readiness from Agent 08."
            ],
            "proposed_changes": [
              "No further changes required from Agent 08; this round was an integration/preservation check plus gate evidence."
            ],
            "acceptance_criteria": [
              "HUD does not crash on boot/manual smoke due to missing message fields.",
              "Debug-only indicators remain gated by DebugPanel visibility (`debug_ui`) and do not allocate per frame excessively.",
              "`python tools/qa_smoke.py --quick` PASS."
            ],
            "risks": [
              "If further merges touch `game/ui/hud.py`, re-check that messages init remains above any message usage, and that debug gating still uses `game_state['debug_ui']`."
            ],
            "dependencies": [
              "Agent 11/12: ensure `hero_stuck_repro` is wired into qa_smoke (Agent 08 has no further dependencies)."
            ],
            "questions_back_to_pm": [],
            "recommended_next_actions": [
              "Proceed with Build A readiness; no remaining Agent 08 work unless QA requests additional debug toggles."
            ],
            "agent_fields": {
              "pm_acknowledged": true,
              "files_checked": [
                "game/ui/hud.py",
                "game/engine.py"
              ],
              "test_commands_run": [
                "python tools/qa_smoke.py --quick"
              ],
              "test_evidence": [
                "[determinism_guard] PASS: no violations found",
                "[qa_smoke] DONE: PASS"
              ],
              "blockers": []
            }
          }
        }
      }
    }
    ,
    "wk3-ui-polish-1080p-pixelart": {
      "sprint_meta": {
        "plan_ref": ".cursor/plans/wk3-ui-polish-1080p-pixelart_f37350f2.plan.md",
        "notes": "WK3: UI redesign owner (layout + theme + widgets), with 1080p borderless default and pixel-art pass (assets/attribution handled by Tools/QA/Art)."
      },
      "rounds": {
        "wk3_r1": {
          "sprint_id": "wk3-ui-polish-1080p-pixelart",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk3-ui-polish-1080p-pixelart_f37350f2.plan.md",
            "notes": ""
          },
          "round_id": "wk3_r1",
          "round_meta": {
            "prompt_set_id": "wk3_kickoff_r1_v1",
            "build_target": "BuildA_midweek+BuildB_endweek",
            "sent_at_local": "2025-12-20T23:07:38.863660-07:00"
          },
          "prompt_text": "WK3 Kickoff (Round 1 / wk3_r1) — UI Polish + 1080p Borderless + Pixel Art. Agent 08: post UI layout spec (top/bottom/right/minimap), typography, tooltip rules, and minimal widget/theme system plan. Include acceptance criteria + test commands; call out dependencies on window scaling + asset conventions/attribution.",
          "response": {
            "received_at_local": "2025-12-20T23:07:38.863660-07:00",
            "status": "complete",
            "raw": "### Status\\nWK3 R1 (async meeting stage): Agent 08 is active. I’m locking the UI **layout spec**, **tooltip rules**, and a minimal **theme/widgets** plan for a Majesty-inspired HUD at 1920×1080 borderless default (hard decision already locked). No heavy implementation in this round.\\n\\n### Deliverables (R1 output)\\n- Layout spec: top bar + bottom command bar + right info panel + bottom-left minimap region, with spacing rules.\\n- Tooltip rules: single source of truth for hotkeys/costs, no spam.\\n- Theme/widgets plan: a small set of reusable primitives to prevent per-screen one-offs.\\n- Acceptance criteria + gates for Build A (UI skeleton + borderless default) and Build B (asset ingestion + polish).\\n\\n### Proposed UI layout (Majesty-inspired)\\n- **Top bar (height ~48px)**: Gold (left), Wave/Day (center), Alerts queue (right).\\n- **Bottom command bar (height ~88–104px)**: icon-first buttons for Build/Hire/Bounty + hover tooltips, with hotkey labels as secondary text.\\n- **Right info panel (width ~340–420px)**: selected hero/building details + action buttons; contains intent/decision, inside-state, and debug-only stuck indicators (when debug UI enabled).\\n- **Bottom-left minimap box (~220–260px square)**: minimap + fog overlay + pings (Build B can enhance).\\n\\n### Widget/theme plan (Build A)\\n- `game/ui/theme.py`: palette, spacing, typography, panel alpha, and 9-slice style constants.\\n- `game/ui/widgets.py`: Panel, Label, IconButton, Tooltip, NineSlice (or border rect) helpers.\\n- Refactor surfaces gradually: start with `game/ui/hud.py` (top/bottom/right scaffolding), then migrate `game/ui/building_panel.py` to use shared widgets.\\n\\n### File boundaries (my domain)\\n- Build A UI skeleton:\\n  - `game/ui/hud.py` (layout + composition; no gameplay logic)\\n  - `game/ui/building_panel.py` (move toward shared widgets)\\n  - `game/ui/theme.py` (new)\\n  - `game/ui/widgets.py` (new)\\n- No window-mode logic here (Agent 3 owns `game/engine.py`/`config.py` display contract).\\n\\n### Acceptance criteria (UI + 1080p)\\n- Default launch is **borderless fullscreen 1920×1080**, fallback to current display resolution if smaller (hard decision locked; implementation by Agent 3).\\n- UI is readable at 1920×1080: no overlap between top bar / right panel / bottom bar.\\n- Build/Hire/Bounty actions are discoverable via icon bar + tooltips (hotkeys included).\\n- `python tools/qa_smoke.py --quick` remains PASS.\\n\\n### Exact test commands\\n- Gate: `python tools/qa_smoke.py --quick`\\n- Manual (UI sanity at launch):\\n  - `python main.py --no-llm` (verify window mode + UI layout readability)\\n  - `python main.py --provider mock`\\n- Build B (assets validation; owned by Tools/QA):\\n  - `python tools/validate_assets.py` (name TBD; must fail if required folders are missing/empty or attribution missing).\\n\\n### Risks (blockers only)\\n- UI scaling contract not yet posted: I won’t implement scaling assumptions until Agent 3 posts the window/scaling contract (how world-space rendering maps to window size and how UI scaling is applied).\\n- Asset conventions/attribution rules not yet locked: do not bake paths into UI until Agent 12/13 lock conventions for `assets/third_party/*` and `assets/ATTRIBUTION.md`.\\n\\n### Dependencies\\n- **Agent 3 (blocker)**: window/scaling contract for borderless 1080p default + fallback behavior; clarify whether the world is letterboxed/pillarboxed or scaled, and where UI is rendered (screen-space overlay).\\n- **Agent 12/13 (blocker)**: asset folder + attribution conventions (exact paths + required files) for CC0/open-license packs.\\n- **Agent 10 (consult)**: perf constraints for UI widgets (surface caching, no per-frame allocations).\\n\\n### Next actions\\n- After Agent 3 posts scaling/window contract: finalize pixel-perfect layout constants and begin Build A UI skeleton (theme + widgets + HUD composition).\\n- After Agent 12/13 lock conventions: add tooltip icon slots and attribution-friendly asset lookup patterns (Build B).\\n",
            "summary_bullets": [
              "WK3 UI layout spec: top bar + bottom command bar + right info panel + minimap region for 1920×1080 borderless default.",
              "Plan to add minimal UI framework: `theme.py` + `widgets.py`, then refactor HUD/building panel to use it.",
              "Explicit wait on Agent 3 window/scaling contract and Agent 12/13 asset+attribution conventions before assuming paths/scales."
            ],
            "proposed_changes": [
              "Build A: implement HUD layout skeleton (top/bottom/right/minimap boxes) using shared widgets and theme primitives.",
              "Build A: migrate existing HUD/building panel rendering to shared Panel/Label/IconButton/Tooltip widgets (incremental).",
              "Build B: integrate icon slots + polish once assets/attribution conventions are locked (do not hardcode until Tools/Marketing confirm)."
            ],
            "acceptance_criteria": [
              "Default launch uses borderless fullscreen 1920×1080; fallback to current display resolution if smaller (Agent 3 implementation).",
              "UI readable at 1920×1080: no overlapping panels; consistent typography and spacing.",
              "Actions discoverable: bottom command bar has icon buttons with tooltips and hotkey hints.",
              "`python tools/qa_smoke.py --quick` PASS.",
              "Manual smoke: `python main.py --no-llm` and `python main.py --provider mock` show correct window mode and no UI crashes."
            ],
            "risks": [
              "Blocker: UI scaling/window mapping contract unknown; do not implement assumptions until Agent 3 posts it.",
              "Blocker: asset/attribution conventions unknown; do not hardcode paths until Agent 12/13 lock them."
            ],
            "dependencies": [
              "Agent 3: window + scaling contract for borderless 1080p default + fallback; UI scale strategy.",
              "Agent 12/13: asset ingestion + attribution conventions (required files/paths)."
            ],
            "questions_back_to_pm": [
              "Blocker question: are we targeting pixel-perfect UI at 1080p (fixed scale) or allowing integer UI scaling for smaller displays (e.g., 0.75/0.5) per Agent 3 contract?"
            ],
            "recommended_next_actions": [
              "Wait for Agent 3 scaling/window contract; then start Build A UI skeleton (theme + widgets + HUD regions).",
              "After Agent 12/13 lock attribution conventions, add validation expectations to tooltips/icon slots (Build B)."
            ],
            "agent_fields": {
              "ui_layout_rules": [
                "Icon-first controls in bottom bar; tooltips provide cost + hotkey + one-line description.",
                "Right panel is the single source of truth for selected entity details/actions.",
                "Keep debug-only diagnostics gated; avoid player-facing clutter by default."
              ],
              "perf_guardrails": [
                "No per-frame Surface allocations in UI; cache rendered text and panel backgrounds.",
                "Avoid per-frame filesystem sprite lookups; rely on cached sprite libraries."
              ],
              "wait_for_contracts": [
                "Agent 3 window/scaling contract",
                "Agent 12/13 asset + attribution conventions"
              ]
            }
          }
        }
        ,
        "wk3_r2": {
          "sprint_id": "wk3-ui-polish-1080p-pixelart",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk3-ui-polish-1080p-pixelart_f37350f2.plan.md",
            "notes": ""
          },
          "round_id": "wk3_r2",
          "round_meta": {
            "prompt_set_id": "wk3_exec_r2_v1",
            "build_target": "BuildA_midweek",
            "sent_at_local": "2025-12-20T23:24:07.218483-07:00"
          },
          "prompt_text": "WK3 Round 2 (wk3_r2): Execute Build A. Agent 08 implement UI skeleton: top bar + bottom command bar + right info panel + minimap region with minimal `theme.py` + `widgets.py` primitives; perf-safe caching; compute layout from actual screen_w/screen_h. Keep `python tools/qa_smoke.py --quick` PASS. No new PNG assets.",
          "response": {
            "received_at_local": "2025-12-20T23:24:07.218483-07:00",
            "status": "complete",
            "raw": "### Status\\nWK3 R2 Build A execution complete for Agent 08: landed a Majesty-inspired HUD **layout skeleton** (top bar / bottom command bar / right info panel / minimap region) with minimal theme+widget primitives and caching to avoid per-frame churn. No new PNG assets.\\n\\n### Deliverables\\n- **UI layout skeleton** computed from the actual render surface size (`surface.get_width()/get_height()`), not hardcoded 1920×1080.\\n- **Minimal UI primitives**:\\n  - `game/ui/theme.py` (`UITheme`)\\n  - `game/ui/widgets.py` (`Panel`, `Tooltip`, `IconButton`)\\n- **Perf-safe caching**:\\n  - Cached panel surfaces per size (`Panel`)\\n  - Cached top-bar value texts (gold/heroes/enemies/wave) rendered only when values change\\n  - Cached placement banner surface only when placing state changes\\n- **Right panel selection**: shows selected hero (existing hero panel) or selected building summary (new minimal building summary).\\n\\n### Files changed\\n- `game/ui/theme.py` (new)\\n- `game/ui/widgets.py` (new)\\n- `game/ui/hud.py` (layout + caching + command bar skeleton + minimap placeholder + right panel)\\n- `game/engine.py` (expose `selected_building` in game_state for right panel)\\n\\n### Test commands run (evidence)\\n- `python tools/qa_smoke.py --quick` => PASS\\n  - `[determinism_guard] PASS: no violations found`\\n  - `[qa_smoke] DONE: PASS`\\n\\n### Notes\\n- Bottom command bar buttons are **visual/discoverability only** in Build A; keyboard controls remain authoritative (no click plumbing added this round).\\n- Minimap is a placeholder panel + label in Build A; real minimap rendering can follow in later rounds.\\n",
            "summary_bullets": [
              "Implemented Build A HUD skeleton: top bar + bottom command bar + right info panel + minimap region (computed from actual screen size).",
              "Added minimal UI framework: `UITheme` + cached `Panel`/`Tooltip`/`IconButton` primitives.",
              "Reduced per-frame allocations by caching top-bar value text + panels + placement banner.",
              "`python tools/qa_smoke.py --quick` PASS."
            ],
            "proposed_changes": [
              "Introduce `game/ui/theme.py` and `game/ui/widgets.py` for reuse and consistent styling.",
              "Refactor `HUD.render()` to compute layout from `surface` size and render cached panels/labels.",
              "Expose `selected_building` in `GameEngine.get_game_state()` to support right info panel content."
            ],
            "acceptance_criteria": [
              "UI skeleton draws correctly at varying window sizes (no hardcoded 1920×1080).",
              "UI remains pixel-crisp (integer coordinates; no fractional scaling in HUD).",
              "No new PNG assets required for Build A.",
              "Caching present for panel surfaces and recurring stat text (no per-frame font.render for stable values).",
              "`python tools/qa_smoke.py --quick` PASS."
            ],
            "risks": [
              "If Agent 3 changes window mode to non-integer scaling, UI crispness could degrade; HUD uses integer coords but overall scaling policy must remain pixel-friendly."
            ],
            "dependencies": [
              "Agent 3: borderless 1920×1080 default + fallback implementation and any scaling policy changes."
            ],
            "questions_back_to_pm": [],
            "recommended_next_actions": [
              "After Agent 3 lands borderless fullscreen default, do a quick manual UI readability pass at 1920×1080 and at a smaller display fallback.",
              "Incrementally migrate `building_panel.py` to reuse widgets/theme (avoid full refactor in one PR)."
            ],
            "agent_fields": {
              "pm_acknowledged": true,
              "files_changed": [
                "game/ui/theme.py",
                "game/ui/widgets.py",
                "game/ui/hud.py",
                "game/engine.py"
              ],
              "test_commands_run": [
                "python tools/qa_smoke.py --quick"
              ],
              "test_evidence": [
                "[determinism_guard] PASS: no violations found",
                "[qa_smoke] DONE: PASS"
              ],
              "blockers": []
            }
          }
        }
        ,
        "wk3_r3": {
          "sprint_id": "wk3-ui-polish-1080p-pixelart",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk3-ui-polish-1080p-pixelart_f37350f2.plan.md",
            "notes": ""
          },
          "round_id": "wk3_r3",
          "round_meta": {
            "prompt_set_id": "wk3_blockers_r3_v1",
            "build_target": "BuildA_midweek",
            "sent_at_local": "2025-12-20T23:32:11.360835-07:00"
          },
          "prompt_text": "WK3 Round 3 (wk3_r3) blockers-only: P0 blocker is smaller-than-1080 fallback safety (no WINDOW_WIDTH/WINDOW_HEIGHT assumptions when actual window is smaller). Agent 08: after Agent 03 lands fix, sanity-check HUD layout still uses surface size + caching intact. No new features.",
          "response": {
            "received_at_local": "2025-12-20T23:32:11.360835-07:00",
            "status": "complete",
            "raw": "### Status\\nBlocker-only update (Agent 08). Agent 03’s P0 fallback-resolution fix is **not yet visible in `game/engine.py`**: there are still several uses of `WINDOW_WIDTH/WINDOW_HEIGHT` in camera centering, edge scroll, and render scaling paths.\\n\\n### What I verified (UI)\\n- `game/ui/hud.py` already computes layout from `surface.get_width()/get_height()` and uses integer coordinates + caching, so it should remain safe once the engine/window-size fix lands.\\n\\n### Evidence / commands\\n- No new commands run in this blockers-only round (waiting on Agent 03 fix to land).\\n\\n### Blocker (needs Agent 03)\\n`game/engine.py` still references `WINDOW_WIDTH/WINDOW_HEIGHT` in window-size-sensitive paths (examples):\\n- `center_on_castle`: camera centers using constants\\n- `update_camera`: edge-scroll bounds use constants\\n- `render`: view surface sizing + `pygame.transform.scale` destinations use constants\\n\\nExpected: these should use `self.window_width/self.window_height` or `self.screen.get_width()/get_height()` consistently.\\n",
            "summary_bullets": [
              "Blocker: engine still uses WINDOW_WIDTH/WINDOW_HEIGHT in camera + render paths; unsafe for smaller-than-1080 fallback.",
              "HUD itself is already surface-size-driven and cached; should be OK once engine fix lands.",
              "Waiting on Agent 03 to land the P0 fix before re-running gates."
            ],
            "proposed_changes": [
              "No code changes from Agent 08 in blockers-only round; will re-check HUD after Agent 03 lands fix."
            ],
            "acceptance_criteria": [
              "After Agent 03 fix lands, HUD still lays out correctly at smaller fallback resolutions (no overlap/clipping) using surface size.",
              "Caching remains intact (no per-frame churn introduced).",
              "`python tools/qa_smoke.py --quick` remains PASS after integration."
            ],
            "risks": [
              "If engine render scaling changes to fractional non-integer scaling, pixel-crisp UI could degrade; HUD uses integer coords but overall scaling policy must remain pixel-friendly."
            ],
            "dependencies": [
              "Agent 03: remove WINDOW_WIDTH/WINDOW_HEIGHT assumptions from render/camera/edge-scroll and use actual window size consistently."
            ],
            "questions_back_to_pm": [],
            "recommended_next_actions": [
              "After Agent 03 lands the fix, re-run `python tools/qa_smoke.py --quick` and do a quick manual visual sanity check at a smaller-than-1080 window.",
              "If any HUD overlap is observed on small displays, apply only minimal layout clamps (no feature adds)."
            ],
            "agent_fields": {
              "pm_acknowledged": true,
              "files_touched": [],
              "test_commands_run": [],
              "test_evidence": [],
              "blockers": [
                "P0 engine fallback resolution safety not yet landed: WINDOW_WIDTH/WINDOW_HEIGHT still used in `game/engine.py` camera + render paths."
              ]
            }
          }
        }
        ,
        "wk3_r4": {
          "sprint_id": "wk3-ui-polish-1080p-pixelart",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk3-ui-polish-1080p-pixelart_f37350f2.plan.md",
            "notes": ""
          },
          "round_id": "wk3_r4",
          "round_meta": {
            "prompt_set_id": "wk3_bugfix_r4_v1",
            "build_target": "BuildA_midweek",
            "sent_at_local": "2025-12-20T23:45:13.636276-07:00"
          },
          "prompt_text": "WK3-BUG-001 (Build A blocker): boot crash `AttributeError: UITheme has no attribute font_title` due to dataclass(slots=True) assigning undeclared attributes in __post_init__. Fix by declaring font fields with init=False and setting in __post_init__. Run: `python main.py --no-llm` boot, `python main.py --provider mock` boot, and `python tools/qa_smoke.py --quick` PASS. Log under wk3_r4.",
          "response": {
            "received_at_local": "2025-12-20T23:45:13.636276-07:00",
            "status": "complete",
            "raw": "### Status\\nFixed WK3-BUG-001: startup crash in `UITheme` caused by `@dataclass(slots=True)` assigning new attributes in `__post_init__`. Kept `slots=True` and declared font fields properly.\\n\\n### Fix\\n- Declared `font_title`, `font_body`, `font_small` as dataclass fields with `init=False` and default `None`, then assigned them in `__post_init__`.\\n\\n### Files changed\\n- `game/ui/theme.py`\\n\\n### Test commands + evidence\\n- Boot (non-interactive dummy video/audio; kill after 2s):\\n  - `python main.py --no-llm` => `boot_ok_no_llm`\\n  - `python main.py --provider mock` => `boot_ok_mock`\\n- Gate:\\n  - `python tools/qa_smoke.py --quick` => PASS\\n    - `[determinism_guard] PASS: no violations found`\\n    - `[qa_smoke] DONE: PASS`\\n",
            "summary_bullets": [
              "Fixed WK3-BUG-001 by declaring font fields on `UITheme` while keeping dataclass `slots=True`.",
              "Verified boot succeeds for `--no-llm` and `--provider mock` (non-interactive dummy driver).",
              "`python tools/qa_smoke.py --quick` PASS."
            ],
            "proposed_changes": [
              "No further changes; bugfix only."
            ],
            "acceptance_criteria": [
              "`python main.py --no-llm` boots without crashing.",
              "`python main.py --provider mock` boots without crashing.",
              "`python tools/qa_smoke.py --quick` PASS."
            ],
            "risks": [],
            "dependencies": [],
            "questions_back_to_pm": [],
            "recommended_next_actions": [
              "Continue WK3 Build A work once Agent 03 lands the fallback-resolution safety fix (separate P0)."
            ],
            "agent_fields": {
              "pm_acknowledged": true,
              "files_changed": [
                "game/ui/theme.py"
              ],
              "test_commands_run": [
                "python main.py --no-llm (dummy driver; killed after 2s)",
                "python main.py --provider mock (dummy driver; killed after 2s)",
                "python tools/qa_smoke.py --quick"
              ],
              "test_evidence": [
                "boot_ok_no_llm",
                "boot_ok_mock",
                "[determinism_guard] PASS: no violations found",
                "[qa_smoke] DONE: PASS"
              ],
              "blockers": []
            }
          }
        }
        ,
        "wk3_r5": {
          "sprint_id": "wk3-ui-polish-1080p-pixelart",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk3-ui-polish-1080p-pixelart_f37350f2.plan.md",
            "notes": ""
          },
          "round_id": "wk3_r5",
          "round_meta": {
            "prompt_set_id": "wk3_exec_r5_v1",
            "build_target": "BuildA_midweek",
            "sent_at_local": "2025-12-21T00:07:32.597569-07:00"
          },
          "prompt_text": "WK3 UI Manageability (P0 polish): Add Quit button to HUD; add X close buttons for hero details panel and debug/perf UI; reposition perf overlay to avoid fighting top bar/right panel. Keep perf-safe (no per-frame churn), no determinism/sim changes, and keep `python tools/qa_smoke.py --quick` PASS. Log under wk3_r5 with evidence.",
          "response": {
            "received_at_local": "2025-12-21T00:07:32.597569-07:00",
            "status": "complete",
            "raw": "### Status\\nWK3 R5 P0 UI manageability implemented: Quit button added, key panels are closeable via X, and perf overlay moved to a less intrusive location. Changes are UI/input only; sim/determinism untouched.\\n\\n### Deliverables\\n- **Quit button** in HUD top bar (click => exit).\\n- **Closeable right info panel**: X button clears selected hero/building.\\n- **Closeable debug panel**: X button hides debug panel; debug UI consumes clicks so it doesn’t select entities behind it.\\n- **Closeable perf overlay**: X button hides perf overlay (`show_perf=False`).\\n- **Perf overlay repositioned** to the bottom-left of the world area (above bottom command bar) to avoid overlapping the top bar/right panel.\\n\\n### Perf-safety\\n- HUD buttons use cached text surfaces and do not create new Surfaces per frame.\\n- Debug panel now caches its panel surface and only rebuilds ~4x/sec or when the log changes (removes per-frame panel Surface allocations while visible).\\n- Perf overlay remains cached and only rebuilt when sampled values change; close button is drawn into the cached panel.\\n\\n### Files changed\\n- `game/ui/hud.py` (Quit + close X; click targets exported for engine)\\n- `game/ui/debug_panel.py` (X close + click handling + caching)\\n- `game/engine.py` (route clicks to HUD/debug/perf before world selection; perf overlay reposition + close hitbox)\\n\\n### Evidence (commands run)\\n- Gate:\\n  - `python tools/qa_smoke.py --quick` => PASS\\n    - `[determinism_guard] PASS: no violations found`\\n    - `[qa_smoke] DONE: PASS`\\n- Headless UI click sanity (dummy SDL):\\n  - Quit click => `ui_quit_click_ok`\\n  - Right panel X closes selection => `ui_right_panel_close_ok`\\n  - Debug X closes => `ui_debug_close_ok`\\n  - Perf X closes => `ui_perf_close_ok`\\n\\n### Manual sanity (human)\\n- Launch `python main.py --no-llm` and `python main.py --provider mock`:\\n  - Click hero/building → close via X\\n  - Toggle debug/perf (F1/F2) → close via X\\n  - Click Quit → exits\\n",
            "summary_bullets": [
              "Added HUD Quit button and routed click to reliably exit game.",
              "Added X close buttons for right info panel (hero/building selection) and debug/perf overlays.",
              "Moved perf overlay to avoid overlapping top bar/right panel; added click-to-close.",
              "`python tools/qa_smoke.py --quick` PASS."
            ],
            "proposed_changes": [
              "HUD: render Quit + right-panel close X and expose click rects for engine hit testing.",
              "Engine: prioritize UI click handling before world selection; add perf close hitbox and reposition overlay.",
              "DebugPanel: add close X and cache panel surface (no per-frame allocations when visible)."
            ],
            "acceptance_criteria": [
              "Quit button present and exits the game reliably when clicked.",
              "Right info panel closable via X (clears selected hero/building).",
              "Debug panel closable via X; clicks inside debug panel do not select entities behind it.",
              "Perf overlay closable via X and no longer obscures top bar/right panel.",
              "`python tools/qa_smoke.py --quick` PASS."
            ],
            "risks": [
              "If Agent 03 changes fallback sizing, ensure perf overlay placement still respects HUD bar sizes (uses HUD heights, should remain safe)."
            ],
            "dependencies": [],
            "questions_back_to_pm": [],
            "recommended_next_actions": [
              "Have QA run the human interactive sanity checklist (click Quit / X closes) on Windows with real display driver.",
              "If users misclick Quit, consider requiring a confirmation modal later (post-Build A)."
            ],
            "agent_fields": {
              "pm_acknowledged": true,
              "files_changed": [
                "game/ui/hud.py",
                "game/ui/debug_panel.py",
                "game/engine.py"
              ],
              "test_commands_run": [
                "python tools/qa_smoke.py --quick",
                "python -c (ui_quit_click_ok)",
                "python -c (ui_right_panel_close_ok)",
                "python -c (ui_debug_close_ok)",
                "python -c (ui_perf_close_ok)"
              ],
              "test_evidence": [
                "[determinism_guard] PASS: no violations found",
                "[qa_smoke] DONE: PASS",
                "ui_quit_click_ok",
                "ui_right_panel_close_ok",
                "ui_debug_close_ok",
                "ui_perf_close_ok"
              ],
              "blockers": []
            }
          }
        }
      }
    }
  }
}

