{
  "schema_version": "2.0",
  "agent": { "id": "05", "name": "GameplaySystemsDesigner" },
  "notes": [
    "This file is owned by Agent 05 only.",
    "Structure nests rounds inside sprints to keep history organized."
  ],
  "sprints": {
    "wk1-broad-sweep-midweek-endweek": {
      "sprint_meta": {
        "plan_ref": ".cursor/plans/wk1-broad-sweep-midweek-endweek_3ca65814.plan.md",
        "notes": ""
      },
      "rounds": {
        "wk1_r1": {
          "sprint_id": "wk1-broad-sweep-midweek-endweek",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk1-broad-sweep-midweek-endweek_3ca65814.plan.md",
            "notes": ""
          },
          "round_id": "wk1_r1",
          "round_meta": {
            "prompt_set_id": "wk1_prompts_v1",
            "build_target": "BuildA_midweek+BuildB_endweek",
            "sent_at_local": "2025-12-20T20:19:37-07:00"
          },
          "prompt_text": "Give recommended default values/bands for bounty rewards, lair bounty cost, and early pressure so pacing feels alive but fair.",
          "response": {
            "received_at_local": "2025-12-20T20:19:37-07:00",
            "status": "complete",
            "raw": "### Status\\nCompleted WK1 Agent 5 (GameplaySystemsDesigner) slice: bounty reward bands + lair bounty sanity + early pressure tuning, with a small fix so attack_lair bounties actually result in lair clearing (not instant proximity payout).\\n\\n### Deliverables\\n- Gameplay tuning doc: docs/sprint/wk1_gameplay_tuning.md\\n- Bounty tiers: Low/Med/High rewards via B, Shift+B, Ctrl+B\\n- Lair tuning: stash + spawn pressure adjustments; LAIR_BOUNTY_COST aligned with expected stash payout\\n- Behavior fix (critical for pacing nudge): attack_lair bounties now pay out on lair_cleared, not on proximity\\n\\n### Notes\\n- Implemented completion-based lair bounty payout (engine pays on lair_cleared if a matching attack_lair bounty exists).\\n- Restricted proximity-claim to explore bounties only.\\n- Updated AI so reaching an attack_lair bounty transitions the hero into attacking the lair target (approach adjacent tile, then CombatSystem handles damage).\\n\\n### Handoff checklist\\n- Files changed: docs/sprint/wk1_gameplay_tuning.md, config.py, game/entities/lair.py, game/entities/building.py, ai/basic_ai.py, game/systems/bounty.py, game/engine.py\\n- How to test: python tools/qa_smoke.py --quick; manual: wait ~90s for starter lair bounty and verify heroes clear lair then get payout.",
            "summary_bullets": [
              "Added bounty reward tiers (Low/Med/High) and tiered placement controls (B / Shift+B / Ctrl+B).",
              "Aligned lair bounty cost vs stash payout; slightly increased lair stash and reduced runaway early pressure via slower lair spawn intervals.",
              "Fixed core behavior bug: attack_lair bounties now pay out on lair_cleared (completion), not proximity; heroes now transition to attacking the lair target."
            ],
            "proposed_changes": [
              "config.py: set STARTING_GOLD=1500, LAIR_BOUNTY_COST=90, LAIR_STASH_GROWTH_PER_SPAWN=8; add BOUNTY_REWARD_LOW/MED/HIGH constants.",
              "game/engine.py: use bounty tier modifiers for explore bounties; pay attack_lair bounties on lair_cleared event.",
              "game/systems/bounty.py: restrict proximity-claiming to explore bounties only.",
              "ai/basic_ai.py: when reaching attack_lair bounty, approach lair and begin attacking; avoid unreachable lair center goals.",
              "game/entities/lair.py: tune base stash + spawn intervals per lair type; preserve deterministic spawn behavior.",
              "game/entities/building.py: add x/y properties mapping to building center for safer targeting logic."
            ],
            "acceptance_criteria": [
              "Placing a bounty is a meaningful decision (cost tiers feel distinct; does not feel free/infinite).",
              "Starter attack_lair bounty results in heroes actually clearing the lair; bounty payout occurs on lair clear, not on arrival.",
              "Early game feels active but not instantly lethal; lair clear yields satisfying gold (stash + bounty) and reads as a chapter beat."
            ],
            "risks": [
              "STARTING_GOLD=1500 may be too tight for some EA onboarding expectations; adjust upward if early build options feel constrained.",
              "Typed bounties other than attack_lair (defend_building/hunt_enemy_type) still need completion hooks to match the completion-based model.",
              "Modifier-key bounty tiers may be non-discoverable without an additional HUD hint/tooltips (PM decision: only keep tiers for WK1 if a minimal hint ships)."
            ],
            "dependencies": [
              "Optional: Agent 8 to add UI hint text for bounty tiers (B / Shift+B / Ctrl+B).",
              "Optional: Agents 3/8 responders + attractiveness UI/logic workstream (separate from tuning)."
            ],
            "questions_back_to_pm": [
              "ACK (Agent 05): PM asks done. Files changed: docs/sprint/wk1_gameplay_tuning.md, config.py, game/engine.py, game/systems/bounty.py, ai/basic_ai.py, game/entities/lair.py, game/entities/building.py. qa_smoke --quick: PASS. Typed bounties cannot proximity-claim (BountySystem.check_claims is explore-only; attack_lair pays on lair_cleared). ETA: done. Blockers: none."
            ],
            "recommended_next_actions": [
              "Coordinate with Agent 8: either add a minimal HUD hint for bounty tier modifiers (B / Shift+B / Ctrl+B) or, if we decide not to ship the hint for Build A, revert to a single default bounty reward for Build A.",
              "Run a short manual feel test to decide whether STARTING_GOLD stays at 1500 or is raised to 2000–3000 (per PM decision).",
              "Follow-up (later): implement completion hooks for defend_building and hunt_enemy_type bounties so all typed bounties are completion-based and consistent."
            ],
            "agent_fields": {
              "pm_acknowledged": true,
              "tuning_recommendations": [
                "BOUNTY_REWARD_LOW=25, BOUNTY_REWARD_MED=60, BOUNTY_REWARD_HIGH=150",
                "LAIR_BOUNTY_COST=90; LAIR_STASH_GROWTH_PER_SPAWN=8; slight per-lair spawn interval slowdowns",
                "STARTING_GOLD=1500 (adjustable to 2000–3000 if onboarding feels too tight)"
              ],
              "metrics_or_targets": [
                "Within first 3 minutes, at least one clear lever/decision prompt is surfaced (bounty tip/starter lair bounty).",
                "Clearing an initial lair should typically yield a satisfying payout (bounty + stash) without spiking difficulty uncontrollably."
              ],
              "pm_followups": {
                "qa_smoke_quick": "PASS",
                "typed_bounty_claim_semantics": "Proximity-claiming restricted to explore only; attack_lair bounty paid on lair_cleared; other typed bounties are not proximity-claimed."
              }
            }
          }
        }
        ,
        "wk1_r3": {
          "sprint_id": "wk1-broad-sweep-midweek-endweek",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk1-broad-sweep-midweek-endweek_3ca65814.plan.md",
            "notes": ""
          },
          "round_id": "wk1_r3",
          "round_meta": {
            "prompt_set_id": "wk1_wrapup_v1",
            "build_target": "BuildA_midweek",
            "sent_at_local": "2025-12-20T21:21:09-07:00"
          },
          "prompt_text": "WK1 Wrap-up Round (wk1_r3): We are preparing to declare Build A ready. Only respond if you have a BLOCKER (qa_smoke fails, crash/softlock in --no-llm/mock, or a must-have acceptance criterion still failing). If you have a blocker, log it here with repro + command/seed + what you need from whom.",
          "response": {
            "received_at_local": "2025-12-20T21:21:09-07:00",
            "status": "complete",
            "raw": "### BLOCKER for Build A readiness\\n\\nPM decisions for Build A require: (a) do not hard-commit STARTING_GOLD=1500 without a quick manual feel test, and (b) modifier-key bounty tiers are acceptable only if Agent 8 ships a minimal HUD hint; otherwise keep a single default bounty reward for Build A.\\n\\nCurrent code state includes both:\\n- Tiered bounty placement (B/Shift+B/Ctrl+B) via BOUNTY_REWARD_LOW/MED/HIGH in config + Engine input handling.\\n- STARTING_GOLD=1500 in config.py.\\n\\nThis is a release readiness blocker unless we either (1) confirm the HUD hint landed, and (2) confirm the starting-gold change is explicitly approved for Build A (or revert it to prior/default for Build A).\\n\\n### Repro (player-visible)\\n1) Run the game (no special flags).\\n2) Observe that bounty placement amount changes with Shift/Ctrl modifiers (no guaranteed discoverability without hint).\\n3) Observe starting gold is 1500 (tuning change) which can materially affect early Build A feel.\\n\\n### Commands / evidence\\n- qa_smoke gate: `python tools/qa_smoke.py --quick` (PASS on my side).\\n- Code locations: `config.py` (STARTING_GOLD + BOUNTY_REWARD_*), `game/engine.py` (place_bounty modifier tiers).\\n\\n### What I need / from whom\\n- Agent 8: confirm and land a minimal HUD hint for bounty tier modifiers (or tell me to revert tiers for Build A).\\n- PM (Agent 01): decide whether STARTING_GOLD=1500 is approved for Build A; if not, I should revert STARTING_GOLD (and any other tuning-only values) to the prior baseline for Build A tagging.\\n\\n---\\n\\n### UPDATE (resolved)\\n- Resolution: Build A includes bounty tier discoverability hint (Agent 08 wk1_r2) AND STARTING_GOLD=1500 explicitly approved via human playtest.\\n- Status: blocker cleared as of 2025-12-20T21:25:36-07:00.",
            "summary_bullets": [
              "Build A blocker: PM-decided conditional items are currently in code (bounty modifier tiers + STARTING_GOLD=1500) without explicit Build A approval/hint confirmation."
            ],
            "proposed_changes": [
              "If Agent 8 HUD hint is not shipping in Build A: revert bounty placement to a single default reward for Build A (keep tiers for Build B).",
              "If STARTING_GOLD=1500 is not approved for Build A: revert STARTING_GOLD to prior baseline for Build A tagging (re-apply tuning in Build B)."
            ],
            "acceptance_criteria": [
              "Build A either includes a minimal HUD hint for bounty tier modifiers OR reverts to a single bounty reward amount for Build A.",
              "Build A either explicitly approves STARTING_GOLD=1500 after quick manual feel test OR reverts STARTING_GOLD for Build A tagging."
            ],
            "risks": [
              "Shipping modifier-key tiers without hint risks player confusion and violates PM’s Build A condition.",
              "Shipping STARTING_GOLD=1500 without explicit approval risks unintended difficulty/economy perception for Build A."
            ],
            "dependencies": [],
            "questions_back_to_pm": [],
            "recommended_next_actions": [],
            "agent_fields": {
              "pm_acknowledged": true,
              "blocker_type": "buildA_scope_condition",
              "qa_smoke_quick": "PASS",
              "blocker_resolved": true,
              "blocker_resolved_at_local": "2025-12-20T21:25:36-07:00",
              "files_implicated": [
                "config.py",
                "game/engine.py"
              ]
            }
          }
        }
      }
    },
    "wk2-hero-polish-ai-sprites": {
      "sprint_meta": {
        "plan_ref": ".cursor/plans/wk2-hero-polish-ai-sprites_5318e148.plan.md",
        "notes": "Agent 05 is Active this sprint per PM kickoff prompt; role is to validate incentive impacts of AI guardrails and propose small tuning knobs."
      },
      "rounds": {
        "wk2_r1": {
          "sprint_id": "wk2-hero-polish-ai-sprites",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk2-hero-polish-ai-sprites_5318e148.plan.md",
            "notes": ""
          },
          "round_id": "wk2_r1",
          "round_meta": {
            "prompt_set_id": "wk2_prompts_v1",
            "build_target": "BuildA_midweek+BuildB_endweek",
            "sent_at_local": "2025-12-20T21:58:35-07:00"
          },
          "prompt_text": "WK2 Kickoff (Round 1 / wk2_r1): Provide Agent 05 meeting-stage output (acceptance criteria, tuning/guardrail recommendations, deterministic repro/QA harness alignment). Wait rule: do not implement/merge contract-dependent work until Agent 3 posts contract surface (inside-combat gating, stuck signals).",
          "response": {
            "received_at_local": "2025-12-20T21:58:35-07:00",
            "status": "complete",
            "raw": "### Status\\nActive (per PM kickoff). Scope: validate that AI anti-jank fixes preserve incentives and don\\'t accidentally nerf core loops (bounty pursuit, lair clearing, retreat fairness), and propose small tuning knobs (commit windows, stuck thresholds) for Agent 6 to implement after Agent 3 locks contracts.\\n\\n### Deliverables (Round 1)\\n- Acceptance criteria focused on incentives + feel regressions to watch for.\\n- Recommended default tuning knobs (numbers) for: target commitment windows, unstuck thresholds, retry caps.\\n- QA/Tools alignment: what deterministic scenario assertions should prove (without writing the tool itself).\\n\\n### Proposed changes (file boundaries; do NOT merge until Agent 3 contracts exist)\\n- No code changes in Round 1.\\n- After Agent 3 contract surface is posted, I may propose minimal constant defaults in a single config/constants location (TBD by Agent 3) used by Agent 6\\'s AI/unstuck logic.\\n- If needed, add/update one doc: `docs/sprint/wk2_gameplay_tuning.md` (tuning table + rationale).\\n\\n### Acceptance criteria (incentive-safe)\\n- **Bounty pursuit remains primary lever**: when a bounty is placed, at least one hero commits to it and does not thrash/flip targets multiple times per second.\\n- **Retreat fairness**: heroes do not enter infinite retreat/return loops; retreat triggers are explainable and not overly conservative.\\n- **No combat while inside buildings**: no damage events or attack animations while `is_inside_building=True`.\\n- **Stuck recovery doesn\\'t kill goals**: unstuck actions should prefer repath/adjacent-tile goals and only abandon bounties after a bounded number of attempts or a max time.\\n\\n### Exact test commands (current + contract-dependent)\\n- Must pass now: `python tools/qa_smoke.py --quick`\\n- Manual smoke (10 min): run in `--no-llm` and `--provider mock` and verify: no attack while inside; no long freezes; bounties still work.\\n- Once Agent 12/11 land deterministic stuck scenario: add to smoke gate and run the provided command (e.g., `python tools/observe_sync.py --scenario hero_stuck_repro ...`).\\n\\n### Recommended tuning defaults (numbers)\\n(These are suggestions for Agent 6 once contracts exist; final location depends on Agent 3\\'s contract/knob decision.)\\n- **Target commitment window**: 1.5s (minimum time before retargeting unless target invalid/dies).\\n- **Bounty commitment window**: 2.5s (avoid oscillation between patrol/enemy/bounty).\\n- **Stuck detection**: intent-to-move but displacement < 0.25 tiles for 2.0s sim-time.\\n- **Unstuck attempts**: max 3 attempts per target before abandoning; backoff 0.5s between attempts (sim-time).\\n- **Unstuck strategies order**: (1) repath to same goal, (2) pick adjacent tile near goal, (3) reset target_position to patrol/home-safe, (4) abandon bounty only if max attempts exceeded.\\n\\n### Risks (blockers only)\\n- If stuck recovery abandons bounties too aggressively, the game loses its primary indirect-control feel.\\n- If anti-oscillation windows are too long, heroes feel unresponsive.\\n- If unstuck uses non-deterministic choices/timing, it will break future MP-readiness and the determinism gate.\\n\\n### Dependencies (blockers)\\n- **Agent 3 contracts/guardrails**: field names + where knobs live (inside-combat gating signal, stuck_reason/attempt counters, sim-time source).\\n- **Agent 12 deterministic repro scenario** + **Agent 11 assertions**: I need the final scenario command + asserted metrics so tuning doesn\\'t cause flaky tests.\\n\\n### Next actions\\n- Wait for Agent 3 contract surface; then provide a precise constant table mapped to those fields (where to set thresholds and what defaults).\\n- Once Agent 12 posts the scenario, sanity-check that the proposed thresholds won\\'t create flakiness and update tuning recommendations accordingly.",
            "summary_bullets": [
              "Provided incentive-safe acceptance criteria for WK2 AI anti-jank (bounties remain primary lever; retreat fairness; no combat inside; unstuck bounded).",
              "Proposed initial numeric tuning defaults (commit windows, stuck thresholds, retry caps) for Agent 6 to implement after Agent 3 contracts lock.",
              "Aligned on QA: keep qa_smoke green now; add deterministic stuck scenario assertions once Tools/QA land it."
            ],
            "proposed_changes": [
              "Round 1: no code changes; produce tuning guidance only.",
              "After Agent 3 contracts: centralize a small set of AI anti-jank tunables (commit windows, stuck thresholds, retry caps) in a single config/constants module chosen by Agent 3.",
              "Optional: add `docs/sprint/wk2_gameplay_tuning.md` with the tuning table + rationale."
            ],
            "acceptance_criteria": [
              "Bounties still reliably attract at least one hero and do not thrash targets excessively (no rapid oscillation).",
              "Heroes do not attack while `is_inside_building=True` (no damage events/attack animations).",
              "Stuck recovery triggers deterministically and resolves freezes without prematurely abandoning bounties.",
              "`python tools/qa_smoke.py --quick` passes; manual 10-minute smoke in `--no-llm` and `--provider mock` shows no long freezes and sane retreat behavior."
            ],
            "risks": [
              "Over-aggressive unstuck/abandon logic can weaken the bounty incentive loop (Majesty feel regression).",
              "Too-long commitment windows can make heroes feel unresponsive; too-short windows can reintroduce thrash.",
              "Non-deterministic unstuck choices/timing could violate determinism gate."
            ],
            "dependencies": [
              "Agent 3: contract surface for inside-combat gating + stuck signals + where tunables should live (blocker for any tuning implementation).",
              "Agent 12/11: deterministic stuck repro scenario + non-flaky assertions to ensure tuning won’t break qa_smoke gate."
            ],
            "questions_back_to_pm": [],
            "recommended_next_actions": [
              "Wait for Agent 3 contracts, then map my proposed tuning defaults onto the final field names/locations and (if approved) implement only constants in the agreed module.",
              "After Agent 12 publishes the deterministic stuck scenario command, validate the thresholds against it (avoid flakiness) and revise defaults if needed."
            ],
            "agent_fields": {
              "pm_acknowledged": true,
              "proposed_tuning_defaults": {
                "target_commit_window_s": 1.5,
                "bounty_commit_window_s": 2.5,
                "stuck_displacement_tiles_threshold": 0.25,
                "stuck_time_s": 2.0,
                "unstuck_max_attempts_per_target": 3,
                "unstuck_backoff_s": 0.5
              },
              "wait_rule": "No contract-dependent code changes until Agent 3 posts/locks contracts (inside-combat gating + stuck signals)."
            }
          }
        }
      }
    }
    ,
    "wk4-new-enemy-skeleton-archer": {
      "sprint_meta": {
        "plan_ref": ".cursor/plans/wk4-new-enemy-skeleton-archer_0feaab3a.plan.md",
        "notes": "WK4 is plan-only in wk4_r1. Agent 05 delivers initial gameplay tunables + balance risks/mitigations for skeleton_archer (ranged kiter) and spawn mix from SkeletonCrypt."
      },
      "rounds": {
        "wk4_r1": {
          "sprint_id": "wk4-new-enemy-skeleton-archer",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk4-new-enemy-skeleton-archer_0feaab3a.plan.md",
            "notes": ""
          },
          "round_id": "wk4_r1",
          "round_meta": {
            "prompt_set_id": "wk4_prompts_v1",
            "build_target": "BuildA_midweek+BuildB_endweek",
            "sent_at_local": "2025-12-25T15:26:09-07:00"
          },
          "prompt_text": "WK4 plan-only kickoff: propose initial tunables for skeleton_archer (HP, attack, speed, attack range, min range, cooldown), propose SkeletonCrypt spawn mix, list balance failure modes + mitigations; include scope split A vs B, acceptance criteria, risks/mitigations, and expected file touchpoints (paths only).",
          "response": {
            "received_at_local": "2025-12-25T15:26:09-07:00",
            "status": "complete",
            "raw": "### Status\\nPlan-only (WK4 R1). As Agent 05, I’m proposing initial gameplay numbers + spawn policy so `skeleton_archer` feels meaningfully different (ranged kiter) without spiking difficulty or breaking the bounty-driven loop.\\n\\nI’m noticing one context gap: parts of this thread show timestamps around 2025-12-20, while the workspace header says 2025-12-25. I’m assuming the sprint plan’s `sprint_id`/`round_id` are the source of truth and the timestamps are just when logs were written.\\n\\n### Deliverables\\n- Initial tunables for `skeleton_archer` (v0) + rationale.\\n- Initial `SkeletonCrypt` spawn mix recommendation (v0) + difficulty-risk notes.\\n- Acceptance criteria for gameplay feel (kite behavior) and “no-scope-creep” Build A baseline (instant-hit ranged).\\n\\n### Proposed scope split (WK4)\\n- **Build A (midweek)**: instant-hit ranged damage + simple kiting behavior (maintain distance band), spawns from SkeletonCrypt, CC0 procedural placeholder art, validator + snapshot coverage, deterministic-safe logic.\\n- **Build B (endweek)**: tuning pass + readability polish (sound/flash cue), optional *simple* projectile/VFX line only if needed for clarity (no physics); perf sanity + additional QA assertions.\\n\\n### Proposed initial tunables (v0)\\nGoal: “annoying pressure” unit that punishes overextending heroes and forces fights to stretch out, but is still killable and not an infinite kite.\\n- **HP**: 40\\n- **Attack (ranged)**: 4\\n- **Speed**: 1.35\\n- **Attack range (tiles)**: 6.0\\n- **Min range (tiles)**: 2.0 (will attempt to kite if hero is closer)\\n- **Attack cooldown (ms)**: 1400\\n- **Gold reward**: same as Skeleton baseline initially (avoid economy spike); can tune later.\\n\\nWhy these numbers: slightly sturdier than goblin but lower DPS than a melee skeleton; longer engagement time; kiting creates indirect pressure without burst-killing peasants instantly.\\n\\n### Spawn mix (SkeletonCrypt)\\n- Start with **80/20** split: `skeleton` / `skeleton_archer`.\\n- If threat feels too low, move to **70/30** in Build B.\\n\\nRationale: crypt already signals “tougher”; archers should be present often enough to be learned, but not so frequent that early parties stall forever.\\n\\n### Acceptance criteria (lock these for implementation)\\n- **Behavior**: `skeleton_archer` attempts to maintain a distance band (min range respected) and attacks from range; it should not stand still and trade in melee unless cornered.\\n- **No infinite kiting**: if kiting fails N times (blocked) it should fall back to a simpler behavior (keep attacking or reposition slightly) to avoid CPU churn.\\n- **No projectile system required for Build A**: instant-hit ranged damage is acceptable as long as there is a readable cue (animation/VFX/audio).\\n- **Determinism**: decisions based on sim-time + seeded RNG only; no wall-clock; stable target selection order.\\n- **Gates**: `python tools/qa_smoke.py --quick` and `python tools/validate_assets.py --strict --check-attribution` pass; Visual Snapshot System `enemy_catalog` includes the new enemy and gallery builds.\\n\\n### Risks + mitigations\\n- **Balance risk: ‘softlock by kiting’** (heroes chase forever, never kill): mitigate with min-range band + bounded repath attempts + occasional “stand-and-shoot” fallback when stuck.\\n- **Balance risk: peasant wipe** (ranged picks off workers): mitigate by using same targeting priorities as other enemies (likely heroes first) and keeping per-hit damage low.\\n- **UX risk: instant-hit feels unfair**: mitigate with clear wind-up animation + small muzzle-flash/beam/arrow-swish VFX (non-projectile) and combat log/HUD message if needed.\\n- **Perf risk: per-frame pathing for kiting**: mitigate with cooldowned repositioning (only re-evaluate every ~0.5–1.0s sim-time) + reuse existing navigation patterns.\\n- **Determinism risk: tie-break drift**: mitigate with stable sorting (entity id/order) and deterministic RNG stream usage.\\n\\n### Concrete file touchpoints (paths only; no implementation yet)\\n- `config.py` (add `SKELETON_ARCHER_*` tunables)\\n- `game/entities/enemy.py` (add enemy class + ranged/kite logic)\\n- `game/entities/lair.py` (SkeletonCrypt spawn mix)\\n- `tools/assets_manifest.json` (add enemy type)\\n- `tools/generate_cc0_placeholders.py` (procedural placeholder frames entry)\\n- `game/graphics/enemy_sprites.py` (ensure fallback recognizes new type)\\n- `tools/screenshot_scenarios.py` (verify enemy_catalog reads manifest; should auto-include)\\n\\n### Questions (blockers only)\\n- None.\\n\\n### Next actions\\n- Wait for PM (wk4_r2) to lock the tunables + spawn mix.\\n- If PM requests tighter numbers, I’ll provide a 2nd pass tuned around observed TTK and chase behavior once a headless repro scenario exists.",
            "summary_bullets": [
              "Proposed v0 skeleton_archer stats (HP/ATK/speed/range/min-range/cooldown) tuned for ‘ranged pressure’ without burst lethality.",
              "Recommended SkeletonCrypt spawn mix 80/20 skeleton/skeleton_archer for Build A; consider 70/30 in Build B if too subtle.",
              "Outlined acceptance criteria + key risks/mitigations (infinite kite, unfair instant-hit feel, determinism/perf guardrails) and expected file touchpoints."
            ],
            "proposed_changes": [
              "Build A: add new enemy type skeleton_archer (instant-hit ranged) + kite distance-band behavior; spawn from SkeletonCrypt; CC0 placeholders; validator + snapshot coverage.",
              "Build B: tuning + readability polish; optional lightweight VFX line for ranged cue (no full projectile system) if needed."
            ],
            "acceptance_criteria": [
              "skeleton_archer spawns from SkeletonCrypt with the locked mix and attacks from range while attempting to maintain a min-range band.",
              "No infinite kiting: bounded reposition attempts and cooldowned reevaluation prevent pathological chase loops.",
              "Determinism guardrails respected (sim-time, seeded RNG streams, stable target ordering).",
              "Release gates pass: `python tools/qa_smoke.py --quick`, `python tools/validate_assets.py --strict --check-attribution`, and Visual Snapshot System enemy catalog includes skeleton_archer and gallery builds."
            ],
            "risks": [
              "If kite logic causes long chases, it can feel like a softlock (mitigate with bounded attempts + fallback).",
              "Instant-hit ranged can feel unfair if cues are weak (mitigate with readable wind-up/VFX/audio).",
              "Reposition pathing could become expensive if evaluated too frequently (mitigate with cooldowned updates)."
            ],
            "dependencies": [
              "Agent 03: lock determinism-safe patterns for target selection + kite movement evaluation cadence (so we don’t introduce non-deterministic drift).",
              "Agent 11/12: ensure smoke + snapshot scenarios include skeleton_archer deterministically (enemy_catalog) and validator covers placeholder assets."
            ],
            "questions_back_to_pm": [],
            "recommended_next_actions": [
              "PM (wk4_r2): lock v0 tunables + spawn mix and assign implementing agent(s).",
              "After implementation: run a short headless scenario + manual smoke to validate TTK/chase behavior; adjust tunables only (no new systems) for Build B if needed."
            ],
            "agent_fields": {
              "pm_acknowledged": true,
              "role_notes": "Gameplay feel + pacing/balance focus; avoid scope creep; Build A stays instant-hit ranged unless PM greenlights extra work.",
              "initial_tunables_v0": {
                "hp": 40,
                "attack": 4,
                "speed": 1.35,
                "attack_range_tiles": 6.0,
                "min_range_tiles": 2.0,
                "attack_cooldown_ms": 1400
              },
              "spawn_mix_v0": {
                "SkeletonCrypt": {
                  "skeleton": 0.8,
                  "skeleton_archer": 0.2
                }
              }
            }
          }
        }
        ,
        "wk4_r2_ack": {
          "sprint_id": "wk4-new-enemy-skeleton-archer",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk4-new-enemy-skeleton-archer_0feaab3a.plan.md",
            "notes": ""
          },
          "round_id": "wk4_r2_ack",
          "round_meta": {
            "prompt_set_id": "wk4_context_refresh_r2_ack_v1",
            "build_target": "BuildA_midweek+BuildB_endweek",
            "sent_at_local": "2026-01-03T08:06:40-07:00"
          },
          "prompt_text": "WK4 context refresh + wk4_r2_ack: Review your own agent log, re-read wk4_r1, confirm understanding of locked Build A decisions (ranged-only, instant-hit, 80/20 spawn mix, manifest+placeholders, gates), list role-specific deliverables, blockers, expected files, and risks/mitigations. Use Status/Deliverables/Questions/Next actions format.",
          "response": {
            "received_at_local": "2026-01-03T08:06:40-07:00",
            "status": "complete",
            "raw": "### Status\\nAgent 05 (GameplaySystemsDesigner) — Context re-ACK for wk4_r2. I've reviewed my wk4_r1 tunables proposal and the locked Build A decisions. My role is tuning/spawn-policy confirmation and Build B-only adjustment guidance (no implementation code changes).\\n\\n### Deliverables (role-specific for WK4)\\n- **Build A tuning signoff**: Confirm v0 tunables (HP40/ATK4/speed1.35/range6/min2/cd1400ms) + crypt spawn mix 80/20 are acceptable under locked constraints.\\n- **Build B-only tuning knobs**: Provide adjustment directions if unit is too lethal/too softlocky/too weak (numbers only; no new systems).\\n- **Review criteria**: Pacing fairness (no infinite kiting, no peasant wipes, readable instant-hit cue).\\n- **Failure mode identification**: Balance risks (softlock-by-kite, unfair instant-hit feel, difficulty spike) + mitigations.\\n\\n### Locked Build A decisions (confirmed understanding)\\n- **Ranged-only**: No melee fallback in Build A.\\n- **Instant-hit ranged**: No projectile system required; minimal deterministic cue (attack pose + impact flash) allowed only if needed for readability.\\n- **Kiting behavior**: Maintain distance band with hysteresis/commitment to avoid jitter oscillation.\\n- **Spawn mix**: SkeletonCrypt spawns 80/20 skeleton/skeleton_archer (deterministic via lair RNG).\\n- **Pipeline completeness**: skeleton_archer added to tools/assets_manifest.json; placeholder PNGs generated (idle/walk/attack/hurt/dead/frame_000.png); validator + enemy_catalog snapshots include it.\\n- **Gates must pass**: python tools/qa_smoke.py --quick, python tools/validate_assets.py --strict --check-attribution, Visual Snapshot System enemy_catalog includes skeleton_archer and gallery builds.\\n\\n### Expected file touchpoints (paths only; no code from Agent 05)\\n- `config.py` (SKELETON_ARCHER_* tunables — implementation owner will add)\\n- `game/entities/enemy.py` (SkeletonArcher class + kite logic — implementation owner)\\n- `game/entities/lair.py` (SkeletonCrypt spawn mix 80/20 — implementation owner)\\n- `tools/assets_manifest.json` (add skeleton_archer — Agent 12)\\n- `tools/generate_cc0_placeholders.py` (generate placeholder frames — Agent 12)\\n- `game/graphics/enemy_sprites.py` (runtime fallback recognition — implementation owner)\\n- `tools/capture_screenshots.py` / `tools/screenshot_scenarios.py` (enemy_catalog scenario — Agent 12)\\n\\n### Risks + mitigations (no scope creep)\\n- **Balance risk: softlock-by-kite** (heroes chase forever): Mitigate with bounded reposition attempt count (e.g., max 3–5 attempts per target) + cooldowned reevaluation (every ~0.5–1.0s sim-time) + fallback to \"stand-and-shoot\" when kite band cannot be maintained.\\n- **Balance risk: peasant wipe** (ranged picks off workers): Mitigate by using same targeting priorities as other enemies (heroes first) and keeping per-hit damage low (ATK 4 is acceptable).\\n- **UX risk: instant-hit feels unfair**: Mitigate with clear wind-up animation + minimal deterministic impact flash (allowed safeguard) and avoid silent damage.\\n- **Perf risk: per-frame pathing for kiting**: Mitigate with cooldowned repositioning (only re-evaluate every ~0.5–1.0s sim-time) + reuse existing navigation patterns (no new pathfinding systems).\\n- **Determinism risk: tie-break drift**: Mitigate with stable sorting (entity id/order) and deterministic RNG stream usage (no wall-clock, no global random.*).\\n- **Difficulty spike risk**: Mitigate via spawn mix (keep 80/20 initially) and low per-hit damage (ATK 4); can adjust to 90/10 or 70/30 in Build B if needed.\\n\\n### Blockers (none currently)\\n- No blockers preventing proceeding to implementation.\\n- Note: I previously flagged an audit trail gap (PM hub wk4_r2 synthesis not found in agent_01 log), but I'm proceeding using the locked decisions from the context refresh prompt as source of truth.\\n\\n### Questions (max 3, blockers only)\\n- None.\\n\\n### Next actions\\n- Wait for implementation owner/integrator to land Build A code changes.\\n- After first playable run (or headless scenario): collect observed TTK/chase behavior issues, then provide Build B-only tuning adjustments (numbers only; no new systems).\\n- If PM requests tighter numbers before implementation: I can provide a 2nd-pass tuning recommendation based on my wk4_r1 proposal + any additional constraints.",
            "summary_bullets": [
              "Context re-ACK: Confirmed understanding of locked Build A decisions (ranged-only, instant-hit, 80/20 spawn mix, pipeline completeness, gates).",
              "Role deliverables: Build A tuning signoff (v0 tunables acceptable), Build B-only adjustment knobs, review criteria for pacing fairness, failure mode identification + mitigations.",
              "No blockers; ready to proceed to implementation. Expected file touchpoints listed (paths only; no code changes from Agent 05)."
            ],
            "proposed_changes": [
              "No code changes from Agent 05 in wk4_r2_ack; this is a context acknowledgment and signoff confirmation only.",
              "After implementation: provide Build B-only tuning adjustments if needed (numbers only; no new systems)."
            ],
            "acceptance_criteria": [
              "Build A uses locked decisions: ranged-only, instant-hit, crypt mix 80/20, pipeline complete (manifest + placeholders + validator + snapshots).",
              "Gameplay: skeleton_archer pressures via range and attempts to maintain distance without infinite kite loops (bounded attempts + fallback).",
              "No projectile system introduced in Build A; only minimal deterministic readability cue if needed (attack pose + impact flash).",
              "Release gates pass: qa_smoke --quick, validate_assets --strict --check-attribution, enemy_catalog snapshots include skeleton_archer."
            ],
            "risks": [
              "If kite logic is too effective, fights can drag into softlocky chases (mitigate with bounded attempts + cooldowned reevaluation + fallback).",
              "Instant-hit can feel unfair without a readable cue (mitigate with attack pose + minimal deterministic impact flash).",
              "Difficulty spike if spawn mix is too high or damage too high (mitigate via 80/20 mix + low ATK 4; adjust in Build B if needed)."
            ],
            "dependencies": [
              "Agent 03: determinism-safe patterns for target selection + kite movement evaluation cadence (so we don't introduce non-deterministic drift).",
              "Agent 12: ensure manifest + placeholder generation + snapshot scenarios include skeleton_archer deterministically.",
              "Implementation owner: keep Build A strictly within locked constraints; wire minimal cue only if instant-hit reads unclear."
            ],
            "questions_back_to_pm": [],
            "recommended_next_actions": [
              "Implementation owner/integrator: proceed with Build A implementation using locked decisions and v0 tunables.",
              "After first run: collect observed TTK/chase behavior; apply Build B-only tuning knobs if needed (no new systems).",
              "PM: if wk4_r2 synthesis exists elsewhere, consider adding it to agent_01 log for audit consistency (non-blocking)."
            ],
            "agent_fields": {
              "pm_acknowledged": true,
              "context_refresh_complete": true,
              "build_a_decisions_confirmed": {
                "ranged_only": true,
                "instant_hit": true,
                "spawn_mix_80_20": true,
                "pipeline_complete": true,
                "gates_required": [
                  "qa_smoke --quick",
                  "validate_assets --strict --check-attribution",
                  "enemy_catalog snapshots"
                ]
              },
              "v0_tunables_signed_off": {
                "hp": 40,
                "attack": 4,
                "speed": 1.35,
                "attack_range_tiles": 6.0,
                "min_range_tiles": 2.0,
                "attack_cooldown_ms": 1400,
                "spawn_mix_skeletoncrypt": {
                  "skeleton": 0.8,
                  "skeleton_archer": 0.2
                }
              },
              "build_b_adjustment_knobs": {
                "if_too_lethal": "reduce attack to 3, increase cooldown to 1600-1800ms, or reduce spawn mix to 90/10",
                "if_too_softlocky": "reduce speed to 1.2, reduce max range to 5.0, or add stronger stand-and-shoot fallback",
                "if_too_weak": "increase spawn mix to 70/30 (Build B only) or slightly increase range to 6.5 while keeping DPS flat"
              }
            }
          }
        }
        ,
        "wk4_r3": {
          "sprint_id": "wk4-new-enemy-skeleton-archer",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk4-new-enemy-skeleton-archer_0feaab3a.plan.md",
            "notes": ""
          },
          "round_id": "wk4_r3",
          "round_meta": {
            "prompt_set_id": "wk4_greenlight_r3_v1",
            "build_target": "BuildA_midweek+BuildB_endweek",
            "sent_at_local": "2025-12-25T15:40:30-07:00"
          },
          "prompt_text": "WK4 wk4_r3 implementation greenlight: as Agent 05, confirm v0 tunables are acceptable for Build A (no debate), recommend Build B adjustments only, list review/signoff criteria for pacing and difficulty, and note any blockers. Include file touchpoints (paths only), how to test, and risks/mitigations. PM synthesis claimed in agent_01 wk4_r2 should be source of truth.",
          "response": {
            "received_at_local": "2025-12-25T15:40:30-07:00",
            "status": "complete",
            "raw": "### Status\\nAgent 05 (GameplaySystemsDesigner) — ACTIVE for wk4_r3, but I am **not** the implementation owner/IC. My deliverable is tuning/spawn-policy signoff + Build B-only tuning suggestions.\\n\\n### Gaps/contradictions noticed\\n- The prompt states PM synthesis is already locked in `agent_01` under wk4_r2, but I cannot locate any `wk4-new-enemy-skeleton-archer` entries in `.cursor/plans/agent_logs/agent_01_ExecutiveProducer_PM.json` (no matches for `wk4`/`skeleton_archer`). For this round, I’m treating the **greenlight prompt’s locked decisions** as the current source of truth and flagging this for PM to fix the audit trail.\\n\\n### Deliverables\\n- Confirm Build A v0 tunables are acceptable for an initial ship (ranged-only, instant-hit, 80/20 crypt mix).\\n- Provide Build B-only tuning knobs if the unit is too oppressive/too weak (numbers + direction).\\n- Provide review criteria for pacing fairness (avoid softlocks, avoid peasant wipes, avoid infinite kiting).\\n\\n### Build A tuning signoff (OK to ship)\\nGiven the locked constraints (ranged-only, instant-hit, crypt mix 80/20), my v0 tunables from wk4_r1 are acceptable as a first pass:\\n- HP 40\\n- Attack 4\\n- Speed 1.35\\n- Attack range 6.0 tiles\\n- Min range 2.0 tiles\\n- Attack cooldown 1400ms\\n- Spawn mix: SkeletonCrypt 80/20 skeleton/skeleton_archer (deterministic via lair RNG)\\n\\n### Build B adjustments (only if needed)\\n- If **too lethal** (peasants dying fast / heroes can’t stabilize): reduce attack to 3, increase cooldown to 1600–1800ms, or reduce spawn mix to 90/10.\\n- If **too annoying/softlocky** (endless chase): reduce speed to 1.2, reduce max range to 5.0, or add stronger ‘stand-and-shoot’ fallback when kite band can’t be maintained (bounded attempts).\\n- If **too weak/unnoticeable**: increase spawn mix to 70/30 (Build B only) or slightly increase range to 6.5 while keeping DPS flat.\\n\\n### Review criteria / acceptance (gameplay feel)\\n- Skeleton archer pressures heroes via range + repositioning but does not create infinite kite loops.\\n- Combat remains readable even with instant-hit (clear attack pose + minimal impact cue is sufficient; no projectile system).\\n- Spawn mix does not spike difficulty: early crypt encounters remain winnable with reasonable hero group.\\n\\n### Files I expect to be touched (by implementation owner; I will not edit)\\n- `config.py` (SKELETON_ARCHER_* tunables)\\n- `game/entities/enemy.py` (SkeletonArcher behavior: kite band + instant-hit ranged)\\n- `game/entities/lair.py` (SkeletonCrypt spawn mix 80/20)\\n- `tools/assets_manifest.json` (add skeleton_archer)\\n- `tools/generate_cc0_placeholders.py` (generate placeholder frames)\\n- `game/graphics/enemy_sprites.py` (runtime fallback recognition)\\n- `tools/capture_screenshots.py` / `tools/screenshot_scenarios.py` (enemy_catalog run)\\n\\n### How to test (for integrator/PM)\\n- Gates: `python tools/qa_smoke.py --quick` and `python tools/validate_assets.py --strict --check-attribution`\\n- Snapshots: `python tools/capture_screenshots.py --scenario enemy_catalog --seed 3 --out docs/screenshots/wk4_after/enemy_catalog_seed3 --size 1920x1080 --ticks 0`\\n- Gallery: `python tools/build_gallery.py --shots docs/screenshots/wk4_after --refs .cursor/plans/art_examples --out docs/art/compare_gallery.html`\\n- Manual sanity: run `python main.py --no-llm` and observe a crypt spawn engages heroes with ranged attacks and attempts to maintain distance (no jitter oscillation).\\n\\n### Risks + mitigations\\n- **Softlock-by-kite**: mitigate with bounded reposition attempt count + cooldowned reevaluation + fallback behavior.\\n- **Unfair instant-hit**: mitigate with strong attack pose + minimal deterministic impact flash (allowed safeguard) and avoid silent damage.\\n- **Difficulty spike**: mitigate via spawn mix (keep 80/20) and low per-hit damage initially.\\n\\n### Ready-for-integration criteria (my signoff)\\n- Config tunables match the v0 values above for Build A.\\n- Spawn mix is exactly 80/20 from SkeletonCrypt, deterministic via lair RNG.\\n- No changes that introduce new systems (no projectile sim) in Build A.",
            "summary_bullets": [
              "Build A tuning signoff: v0 skeleton_archer tunables (HP40/ATK4/speed1.35/range6/min2/cd1400ms) + crypt mix 80/20 are acceptable for initial ship under locked constraints.",
              "Build B-only adjustment knobs provided (reduce DPS/spawn mix if lethal; reduce speed/range if softlocky; increase mix if too subtle).",
              "Flagged audit trail gap: PM hub wk4_r2 synthesis referenced by prompt not present in agent_01 log; proceeding using this prompt’s locked decisions."
            ],
            "proposed_changes": [
              "No code changes from Agent 05 in wk4_r3; provide tuning signoff + review criteria only.",
              "If needed in Build B: adjust attack/cooldown/speed/range/spawn mix as per guidance (no new systems)."
            ],
            "acceptance_criteria": [
              "Build A uses locked decisions: ranged-only, instant-hit, crypt mix 80/20, pipeline complete (manifest + placeholders + validator + snapshots).",
              "Gameplay: skeleton_archer pressures via range and attempts to maintain distance without infinite kite loops.",
              "No projectile system introduced in Build A; only minimal deterministic readability cue if needed."
            ],
            "risks": [
              "If kite logic is too effective, fights can drag into softlocky chases (mitigate with bounded attempts + fallback).",
              "Instant-hit can feel unfair without a readable cue (mitigate with attack pose + minimal impact flash).",
              "Audit trail gap: PM synthesis location referenced but missing (mitigate by PM adding the wk4_r2 entry for consistency)."
            ],
            "dependencies": [
              "PM: add/fix `wk4_r2` synthesis entry in agent_01 log so all agents have a single source of truth."
            ],
            "questions_back_to_pm": [
              "Blocker (process/audit): can you confirm where the locked `wk4_r2` PM synthesis is recorded? I could not find it in agent_01; I proceeded using the greenlight prompt’s locked decisions."
            ],
            "recommended_next_actions": [
              "Implementation owner/integrator: keep Build A strictly within locked constraints; wire minimal cue only if instant-hit reads unclear.",
              "PM: publish/restore wk4_r2 synthesis in agent_01 log for audit consistency.",
              "After first run: collect observed TTK/chase issues, then apply Build B-only tuning knobs (no new systems)."
            ],
            "agent_fields": {
              "pm_acknowledged": true,
              "ready_for_integration": true,
              "role": "tuning_signoff_only",
              "build_a_tuning_signed_off": true,
              "signed_off_values_build_a": {
                "hp": 40,
                "attack": 4,
                "speed": 1.35,
                "attack_range_tiles": 6.0,
                "min_range_tiles": 2.0,
                "attack_cooldown_ms": 1400,
                "spawn_mix_skeletoncrypt": {
                  "skeleton": 0.8,
                  "skeleton_archer": 0.2
                }
              }
            }
          }
        }
        ,
        "wk4_r3": {
          "sprint_id": "wk4-new-enemy-skeleton-archer",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk4-new-enemy-skeleton-archer_0feaab3a.plan.md",
            "notes": ""
          },
          "round_id": "wk4_r3",
          "round_meta": {
            "prompt_set_id": "wk4_implementation_greenlight_r3_v1",
            "build_target": "BuildA_midweek",
            "sent_at_local": "2026-01-03T08:21:34-07:00"
          },
          "prompt_text": "WK4 wk4_r3 implementation: As Agent 05 (IMPLEMENT owner), implement gameplay code changes: config.py (SKELETON_ARCHER_* tunables), game/entities/enemy.py (SkeletonArcher class with ranged kiting), game/entities/lair.py (80/20 crypt spawn mix). Keep determinism/perf guardrails. Run gates and provide evidence.",
          "response": {
            "received_at_local": "2026-01-03T08:21:34-07:00",
            "status": "complete",
            "raw": "### Status\\nAgent 05 (GameplaySystemsDesigner) — IMPLEMENT owner for WK4 Build A gameplay code. Implemented skeleton_archer enemy class with ranged kiting behavior, added config tunables, and updated SkeletonCrypt spawn mix to 80/20. All determinism/perf guardrails respected (sim-time only, seeded RNG, stable ordering, rate-limited reposition).\\n\\n### Deliverables\\n- **config.py**: Added SKELETON_ARCHER_* tunables (HP=40, ATK=4, speed=1.35, range=6.0 tiles, min_range=2.0 tiles, cooldown=1400ms).\\n- **game/entities/enemy.py**: Implemented SkeletonArcher class with:\\n  - Ranged-only instant-hit attack (no projectile system)\\n  - Kiting behavior: maintains distance band (min_range to attack_range)\\n  - Hysteresis/commitment: 500ms commitment window to avoid jitter\\n  - Cooldowned repositioning: re-evaluates every 800ms (sim-time)\\n  - Bounded attempts: max 5 kite attempts per target, then fallback to stand-and-shoot\\n  - Deterministic: uses now_ms() for all timing, stable target key tracking\\n- **game/entities/lair.py**: Updated SkeletonCrypt.spawn_enemies to use deterministic 80/20 mix (skeleton/skeleton_archer) via lair RNG.\\n\\n### Files changed\\n- `config.py`: Added SKELETON_ARCHER_HP, SKELETON_ARCHER_ATTACK, SKELETON_ARCHER_SPEED, SKELETON_ARCHER_ATTACK_RANGE_TILES, SKELETON_ARCHER_MIN_RANGE_TILES, SKELETON_ARCHER_ATTACK_COOLDOWN_MS\\n- `game/entities/enemy.py`: Added SkeletonArcher class (396-556 lines) with kiting update() override; updated imports to include new config constants\\n- `game/entities/lair.py`: Updated SkeletonCrypt.spawn_enemies() to use 80/20 mix; added SkeletonArcher to imports\\n\\n### How to test\\n- **Gate 1**: `python tools/qa_smoke.py --quick` → PASS (exit_code=0)\\n- **Gate 2**: `python tools/validate_assets.py --strict --check-attribution` → Pending Agent 12 (manifest + placeholders)\\n- **Gate 3**: `python tools/capture_screenshots.py --scenario enemy_catalog --seed 3 --out docs/screenshots/wk4_after/enemy_catalog_seed3 --size 1920x1080 --ticks 0` → Pending Agent 12 (manifest update)\\n- **Gate 4**: `python tools/build_gallery.py --shots docs/screenshots/wk4_after --refs .cursor/plans/art_examples --out docs/art/compare_gallery.html` → Pending Agent 12\\n- **Manual smoke**: Run `python main.py --no-llm` and observe SkeletonCrypt spawns include skeleton_archer (80/20 mix); verify archer attacks from range and attempts to maintain distance (no jitter oscillation).\\n\\n### Evidence (commands + outputs)\\n- **qa_smoke --quick**: PASS\\n  - determinism_guard: PASS (no violations)\\n  - All scenarios: PASS (default, intent_bounty, hero_stuck_repro, no-enemies, mock-LLM)\\n  - Exit code: 0\\n  - Full output: see terminal output above (determinism_guard PASS, all observe_sync scenarios PASS)\\n\\n### Risks + mitigations (implemented)\\n- **Softlock-by-kite**: Mitigated with bounded attempts (max 5) + fallback to stand-and-shoot when attempts exceeded.\\n- **Jitter oscillation**: Mitigated with hysteresis/commitment window (500ms) + cooldowned repositioning (800ms interval).\\n- **Perf risk**: Mitigated with rate-limited reposition evaluations (only every ~0.8s sim-time) + reuse existing navigation patterns.\\n- **Determinism risk**: Mitigated with sim-time only (now_ms()), stable target key tracking (id/position tuple), deterministic lair RNG for spawn mix.\\n\\n### Dependencies (blockers resolved)\\n- **Agent 12**: Must add skeleton_archer to tools/assets_manifest.json and generate placeholder PNGs before validate_assets + snapshot gates can pass. This is expected and non-blocking for gameplay code implementation.\\n- **Agent 09**: Visual signoff on placeholder silhouette (bow/quiver cues) — expected after Agent 12 generates placeholders.\\n\\n### Ready-for-integration criteria (met)\\n- Config tunables match v0 values (HP40/ATK4/speed1.35/range6/min2/cd1400ms).\\n- Spawn mix is exactly 80/20 from SkeletonCrypt, deterministic via lair RNG.\\n- No new systems introduced (no projectile sim); only minimal deterministic readability cues (attack pose via animation system).\\n- Determinism guardrails respected: sim-time only, seeded RNG streams, stable ordering.\\n- qa_smoke --quick PASS.\\n\\n### Follow-ups (Build B only)\\n- If unit is too lethal: reduce attack to 3, increase cooldown to 1600-1800ms, or reduce spawn mix to 90/10.\\n- If too softlocky: reduce speed to 1.2, reduce max range to 5.0, or strengthen stand-and-shoot fallback.\\n- If too weak: increase spawn mix to 70/30 or slightly increase range to 6.5 while keeping DPS flat.",
            "summary_bullets": [
              "Implemented skeleton_archer enemy class with ranged kiting behavior (maintains distance band, hysteresis/commitment, bounded attempts, fallback to stand-and-shoot).",
              "Added SKELETON_ARCHER_* tunables to config.py (HP40/ATK4/speed1.35/range6/min2/cd1400ms) matching v0 signoff.",
              "Updated SkeletonCrypt spawn mix to deterministic 80/20 (skeleton/skeleton_archer) via lair RNG.",
              "All determinism/perf guardrails respected (sim-time only, seeded RNG, stable ordering, rate-limited reposition).",
              "qa_smoke --quick PASS; validate_assets + snapshot gates pending Agent 12 (manifest + placeholders)."
            ],
            "proposed_changes": [
              "config.py: Added SKELETON_ARCHER_* tunables (HP, attack, speed, attack_range_tiles, min_range_tiles, attack_cooldown_ms).",
              "game/entities/enemy.py: Added SkeletonArcher class with ranged kiting behavior (override update() method with distance band logic, hysteresis/commitment, bounded attempts, fallback).",
              "game/entities/lair.py: Updated SkeletonCrypt.spawn_enemies() to use deterministic 80/20 mix (skeleton/skeleton_archer) via lair RNG."
            ],
            "acceptance_criteria": [
              "skeleton_archer spawns from SkeletonCrypt with 80/20 mix deterministically.",
              "skeleton_archer attacks from range (6.0 tiles) and attempts to maintain distance band (min_range 2.0 tiles) without infinite kite loops.",
              "Kiting behavior uses hysteresis/commitment (500ms window) and cooldowned repositioning (800ms interval) to avoid jitter oscillation.",
              "Bounded attempts (max 5) with fallback to stand-and-shoot prevents softlock-by-kite.",
              "Determinism guardrails respected: sim-time only (now_ms()), seeded RNG streams, stable target ordering.",
              "qa_smoke --quick PASS; validate_assets + snapshot gates pending Agent 12 (manifest + placeholders)."
            ],
            "risks": [
              "If kite logic is too effective, fights can drag into softlocky chases (mitigated with bounded attempts + fallback).",
              "Jitter oscillation if repositioning evaluated too frequently (mitigated with hysteresis/commitment + cooldowned repositioning).",
              "Perf risk if repositioning triggers A* too often (mitigated with rate-limited evaluations + reuse existing navigation patterns)."
            ],
            "dependencies": [
              "Agent 12: Must add skeleton_archer to tools/assets_manifest.json and generate placeholder PNGs before validate_assets + snapshot gates can pass (expected, non-blocking for gameplay code).",
              "Agent 09: Visual signoff on placeholder silhouette (bow/quiver cues) — expected after Agent 12 generates placeholders."
            ],
            "questions_back_to_pm": [],
            "recommended_next_actions": [
              "Agent 12: Add skeleton_archer to tools/assets_manifest.json and generate placeholder PNGs (idle/walk/attack/hurt/dead/frame_000.png).",
              "After Agent 12: Run validate_assets --strict --check-attribution and enemy_catalog snapshot commands to complete pipeline gates.",
              "Manual smoke: Run python main.py --no-llm and observe SkeletonCrypt spawns include skeleton_archer (80/20 mix); verify archer attacks from range and maintains distance.",
              "Build B: Collect observed TTK/chase behavior; apply tuning adjustments if needed (numbers only; no new systems)."
            ],
            "agent_fields": {
              "pm_acknowledged": true,
              "ready_for_integration": true,
              "implementation_complete": true,
              "files_changed": [
                "config.py",
                "game/entities/enemy.py",
                "game/entities/lair.py"
              ],
              "qa_smoke_quick": "PASS",
              "qa_smoke_exit_code": 0,
              "determinism_guard": "PASS",
              "gates_pending_agent_12": [
                "validate_assets --strict --check-attribution",
                "enemy_catalog snapshot",
                "gallery build"
              ],
              "implementation_details": {
                "skeleton_archer_class": "Added SkeletonArcher class (lines 396-556) with ranged kiting behavior",
                "kiting_features": [
                  "Distance band maintenance (min_range to attack_range)",
                  "Hysteresis/commitment window (500ms)",
                  "Cooldowned repositioning (800ms interval)",
                  "Bounded attempts (max 5) with fallback to stand-and-shoot",
                  "Deterministic: sim-time only, stable target key tracking"
                ],
                "spawn_mix": "SkeletonCrypt: 80/20 skeleton/skeleton_archer (deterministic via lair RNG)"
              }
            }
          }
        }
      }
    }
    ,
    "wk5-demolition-projectiles-workers": {
      "sprint_meta": {
        "plan_ref": ".cursor/plans/wk5_demolition+projectiles_d4ea82e0.plan.md",
        "notes": "WK5 adds building demolition (auto + player), visible ranged projectiles (generic pipeline), and worker pixel sprites (peasant + tax collector). Agent 05 defines ranged attacker classification, projectile tuning knobs, and demolish gameplay guardrails."
      },
      "rounds": {
        "wk5_r1": {
          "sprint_id": "wk5-demolition-projectiles-workers",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk5_demolition+projectiles_d4ea82e0.plan.md",
            "notes": ""
          },
          "round_id": "wk5_r1",
          "round_meta": {
            "prompt_set_id": "wk5_planning_r1_v1",
            "build_target": "BuildA_midweek+BuildB_endweek",
            "sent_at_local": "2026-01-03T09:25:58-07:00"
          },
          "prompt_text": "WK5 planning: Define 'ranged attacker' classification rules for all current and future ranged units. Recommend first-pass projectile tuning knobs (lifetime, speed, color, size) for readability. Clarify demolish gameplay guardrails: allowed while under attack? allowed for under-construction buildings?",
          "response": {
            "received_at_local": "2026-01-03T09:25:58-07:00",
            "status": "complete",
            "raw": "### Status\\nAgent 05 (GameplaySystemsDesigner) — WK5 R1 planning recommendations for ranged attacker classification, projectile tuning, and demolish gameplay guardrails.\\n\\n### Deliverables\\n- **Ranged attacker classification rules**: Clear, extensible definition for heroes, enemies, and buildings (present + future).\\n- **Projectile tuning knobs (v0)**: Lifetime, speed, color, size recommendations for readability at 32×32 pixel scale.\\n- **Demolish gameplay guardrails**: Rules for when player demolish is allowed (under attack? under construction?) and UX considerations.\\n\\n### Ranged Attacker Classification Rules\\n\\n**Core definition**: An entity is a \"ranged attacker\" if it meets ALL of the following criteria:\\n1. **Attack range > melee threshold**: `attack_range > TILE_SIZE * 1.8` (melee is typically TILE_SIZE * 1.2 to 1.5)\\n2. **No melee fallback required**: The entity does not require physical contact to deal damage (instant-hit or projectile-based)\\n3. **Explicit ranged flag OR class-based**: Either `is_ranged_attacker = True` OR `hero_class == \"ranger\"` OR `enemy_type in [\"skeleton_archer\", ...]` OR building has `attack_range` property set > melee threshold\\n\\n**Current ranged attackers (Build A scope)**:\\n- **Heroes**: `hero_class == \"ranger\"` (rangers from RangerGuild)\\n- **Enemies**: `enemy_type == \"skeleton_archer\"` (from WK4)\\n- **Buildings**: `BallistaTower` (has `attack_range = 200` pixels, which is > TILE_SIZE * 1.8 = ~57.6 pixels)\\n\\n**Future-proofing interface recommendation**:\\n- Prefer `is_ranged_attacker` boolean property (explicit, no ambiguity)\\n- Fallback to `get_ranged_spec()` method if metadata is needed (returns `None` for melee, `{\"projectile_kind\": \"arrow\", \"color\": (r,g,b), \"size_px\": 2}` for ranged)\\n- For heroes: check `hero_class == \"ranger\"` OR `is_ranged_attacker == True`\\n- For enemies: check `enemy_type in RANGED_ENEMY_TYPES` OR `is_ranged_attacker == True`\\n- For buildings: check `hasattr(building, \"attack_range\") and building.attack_range > TILE_SIZE * 1.8` OR `is_ranged_attacker == True`\\n\\n**Implementation note**: The `get_ranged_spec()` method should return projectile metadata (kind, color, size) for VFX system, but the boolean `is_ranged_attacker` is sufficient for combat event emission.\\n\\n### Projectile Tuning Knobs (v0 — Build A)\\n\\n**Goal**: Readable at 32×32 pixel scale, visible but not overwhelming, deterministic (no wall-clock dependencies).\\n\\n**Lifetime (travel time)**:\\n- **Arrow/bolt (rangers, skeleton_archer)**: 80–120ms (fast enough to feel instant but visible)\\n- **Ballista bolt (towers)**: 100–140ms (slightly slower for larger projectile)\\n- Rationale: Too fast (<60ms) = invisible; too slow (>200ms) = feels laggy. 80–140ms is the sweet spot for 32×32 readability.\\n\\n**Speed (pixels per second)**:\\n- Calculate from distance and lifetime: `speed = distance / (lifetime_ms / 1000.0)`\\n- For typical ranges (6 tiles = 192px), 80ms lifetime = 2400 px/s (feels snappy)\\n- For longer ranges (12 tiles = 384px), 120ms lifetime = 3200 px/s (still readable)\\n- **Recommendation**: Use constant speed (e.g., 3000 px/s) and derive lifetime from distance: `lifetime_ms = (distance_px / 3000.0) * 1000`, clamped to 80–140ms.\\n\\n**Color (palette + contrast)**:\\n- **Arrow (ranger, skeleton_archer)**: `(200, 200, 50)` yellow-amber with outline `(100, 100, 20)` for contrast\\n- **Ballista bolt (tower)**: `(180, 180, 200)` light gray-blue with outline `(80, 80, 100)`\\n- Rationale: Yellow-amber reads as \"arrow\" at 32×32; gray-blue reads as \"mechanical bolt\". Both have sufficient contrast against grass/water/trees.\\n\\n**Size (pixels)**:\\n- **Arrow**: 1–2 px (thin line, reads as arrow shaft)\\n- **Ballista bolt**: 2–3 px (thicker, reads as heavy projectile)\\n- Rationale: 1–2 px is readable at 32×32 without overwhelming the sprite; 2–3 px for towers feels \"heavier\".\\n\\n**Determinism requirement**: All projectile parameters (lifetime, speed, color, size) must be derived from event fields (attacker type, target position) or seeded RNG (not wall-clock time).\\n\\n### Demolish Gameplay Guardrails\\n\\n**Player demolish rules (Build A)**:\\n- **Allowed**:\\n  - Any non-castle building that is constructed (`is_constructed == True`)\\n  - Buildings under attack (no restriction — player can demolish to save resources if building is doomed)\\n  - Buildings with heroes inside (demolish clears heroes out, but warn player if heroes are resting inside)\\n- **Not allowed (disabled button)**:\\n  - Castle (game over trigger, must stay)\\n  - Under-construction buildings (`is_constructed == False` or `construction_started == False`)\\n  - Rationale: Under-construction buildings are \"not yet built\" — player should cancel placement instead (if that feature exists) or wait for construction to complete.\\n\\n**Auto-demolish rules (0 HP)**:\\n- **Auto-demolish**: All buildings except castle when `hp <= 0`\\n- **No refund**: Auto-demolish does not refund gold (same as player demolish)\\n- **Reference cleanup**: Engine must clear all references (hero.target, enemy.target, peasant.target_building, selected_building, etc.) before removal\\n- **Lair special case**: If destroyed building is a lair (`is_lair == True`), remove from `lair_system.lairs` list and clear any bounties targeting it\\n\\n**UX considerations (Build A vs Build B)**:\\n- **Build A**: Instant demolish, no confirmation (fast iteration, low friction)\\n- **Build B (if misclicks observed)**: Optional confirmation dialog OR hold-to-demolish (e.g., hold button for 500ms) for non-critical buildings\\n- **Warning message (Build A)**: If demolishing a building with heroes inside, show HUD message: \"Demolished: [Building Name]. Heroes inside have been ejected.\"\\n\\n**Edge cases**:\\n- **Demolish while building is being repaired**: Allowed (player can stop repair by demolishing)\\n- **Demolish while peasant is working on it**: Allowed (peasant will lose target and return to idle)\\n- **Demolish while enemy is attacking it**: Allowed (enemy will retarget to nearest valid target)\\n- **Demolish lair while heroes are attacking it**: Allowed (heroes will lose target, may retarget to nearest enemy or return to patrol)\\n\\n### Acceptance Criteria\\n- Ranged attackers are correctly identified via `is_ranged_attacker` boolean OR class/type checks (ranger, skeleton_archer, BallistaTower).\\n- Projectiles are visible and readable at 32×32 scale (80–140ms lifetime, 1–3 px size, high contrast colors).\\n- Player demolish is instant and works for all constructed non-castle buildings (including under attack).\\n- Player demolish is disabled for castle and under-construction buildings.\\n- Auto-demolish triggers at 0 HP for all non-castle buildings with proper reference cleanup.\\n- No refunds on demolish (player or auto).\\n\\n### Risks + Mitigations\\n- **Risk: Projectile readability at 32×32**: Mitigate with high-contrast colors (yellow-amber with dark outline) and 1–2 px size (thin but visible).\\n- **Risk: Projectile feels laggy if too slow**: Mitigate with constant speed (3000 px/s) and distance-based lifetime (80–140ms clamp).\\n- **Risk: Player accidentally demolishes important building**: Mitigate with Build A instant (low friction) + Build B optional confirmation if misclicks observed.\\n- **Risk: Demolish while under attack feels unfair**: Mitigate by allowing it (player can save resources if building is doomed) but warn if heroes inside.\\n- **Risk: Under-construction demolish confusion**: Mitigate by disabling demolish button for under-construction buildings (player must wait or cancel placement).\\n- **Risk: Reference cleanup misses edge cases**: Mitigate with centralized cleanup pass in engine (check all known reference types: hero.target, enemy.target, peasant.target_building, selected_building, lair_system.lairs).\\n\\n### Dependencies\\n- **Agent 03**: Architecture for `is_ranged_attacker` interface and `get_ranged_spec()` method signature.\\n- **Agent 08**: UX specification for demolish button placement, label, color, and disabled states.\\n- **Agent 09**: Art briefs for projectile colors/sizes and ranger bow readability.\\n- **Agent 11**: QA checklist for demolish edge cases and projectile visibility tests.\\n\\n### Questions (blockers only)\\n- None.\\n\\n### Recommended Next Actions\\n- Agent 03: Implement `is_ranged_attacker` boolean property and `get_ranged_spec()` method for heroes, enemies, and buildings.\\n- Agent 08: Design demolish button UX (placement, label, color, disabled states) and microcopy.\\n- Agent 09: Provide art briefs for projectile colors/sizes and ranger bow sprite cues.\\n- Implementation: Wire ranged attacker detection in combat system and emit projectile events.\\n- Implementation: Add demolish button to building panel and engine action handler.\\n- QA: Test demolish edge cases (under attack, heroes inside, under construction) and projectile visibility at 32×32 scale.",
            "summary_bullets": [
              "Defined ranged attacker classification: attack_range > TILE_SIZE * 1.8, no melee fallback, explicit flag OR class-based (ranger, skeleton_archer, BallistaTower).",
              "Recommended projectile tuning v0: lifetime 80–140ms (distance-based), speed 3000 px/s constant, color yellow-amber (arrow) / gray-blue (bolt), size 1–3 px.",
              "Clarified demolish guardrails: allowed for constructed buildings (including under attack), disabled for castle and under-construction buildings, no refunds, proper reference cleanup."
            ],
            "proposed_changes": [
              "Add `is_ranged_attacker` boolean property to heroes, enemies, and buildings (explicit flag for ranged classification).",
              "Add `get_ranged_spec()` method (optional) returning projectile metadata (kind, color, size) for VFX system.",
              "Implement projectile event emission in combat system when `is_ranged_attacker == True`.",
              "Add demolish button to building panel (disabled for castle and under-construction buildings).",
              "Implement auto-demolish cleanup pass in engine (0 HP removal with reference cleanup)."
            ],
            "acceptance_criteria": [
              "Ranged attackers correctly identified via `is_ranged_attacker` boolean OR class/type checks (ranger, skeleton_archer, BallistaTower).",
              "Projectiles visible and readable at 32×32 scale (80–140ms lifetime, 1–3 px size, high contrast colors).",
              "Player demolish instant for all constructed non-castle buildings (including under attack).",
              "Player demolish disabled for castle and under-construction buildings.",
              "Auto-demolish triggers at 0 HP for all non-castle buildings with proper reference cleanup.",
              "No refunds on demolish (player or auto)."
            ],
            "risks": [
              "Projectile readability at 32×32 scale (mitigate with high-contrast colors and 1–2 px size).",
              "Projectile feels laggy if too slow (mitigate with constant speed 3000 px/s and distance-based lifetime).",
              "Player accidentally demolishes important building (mitigate with Build A instant + Build B optional confirmation if misclicks observed).",
              "Demolish while under attack feels unfair (mitigate by allowing it but warn if heroes inside).",
              "Reference cleanup misses edge cases (mitigate with centralized cleanup pass checking all known reference types)."
            ],
            "dependencies": [
              "Agent 03: Architecture for `is_ranged_attacker` interface and `get_ranged_spec()` method signature.",
              "Agent 08: UX specification for demolish button placement, label, color, and disabled states.",
              "Agent 09: Art briefs for projectile colors/sizes and ranger bow readability.",
              "Agent 11: QA checklist for demolish edge cases and projectile visibility tests."
            ],
            "questions_back_to_pm": [],
            "recommended_next_actions": [
              "Agent 03: Implement `is_ranged_attacker` boolean property and `get_ranged_spec()` method for heroes, enemies, and buildings.",
              "Agent 08: Design demolish button UX (placement, label, color, disabled states) and microcopy.",
              "Agent 09: Provide art briefs for projectile colors/sizes and ranger bow sprite cues.",
              "Implementation: Wire ranged attacker detection in combat system and emit projectile events.",
              "Implementation: Add demolish button to building panel and engine action handler.",
              "QA: Test demolish edge cases (under attack, heroes inside, under construction) and projectile visibility at 32×32 scale."
            ],
            "agent_fields": {
              "ranged_attacker_classification": {
                "core_definition": "attack_range > TILE_SIZE * 1.8, no melee fallback, explicit flag OR class-based",
                "current_ranged": {
                  "heroes": ["ranger"],
                  "enemies": ["skeleton_archer"],
                  "buildings": ["BallistaTower"]
                },
                "interface_recommendation": "is_ranged_attacker boolean OR get_ranged_spec() method"
              },
              "projectile_tuning_v0": {
                "lifetime_ms": "80–140ms (distance-based, clamped)",
                "speed_px_per_s": "3000 (constant)",
                "colors": {
                  "arrow": "(200, 200, 50) yellow-amber with outline (100, 100, 20)",
                  "bolt": "(180, 180, 200) light gray-blue with outline (80, 80, 100)"
                },
                "size_px": {
                  "arrow": "1–2 px",
                  "bolt": "2–3 px"
                }
              },
              "demolish_guardrails": {
                "player_demolish_allowed": ["constructed buildings", "buildings under attack", "buildings with heroes inside (with warning)"],
                "player_demolish_disabled": ["castle", "under-construction buildings"],
                "auto_demolish": "all non-castle buildings at 0 HP, no refund, proper reference cleanup",
                "ux_build_a": "instant demolish, no confirmation",
                "ux_build_b": "optional confirmation or hold-to-demolish if misclicks observed"
              }
            }
          }
        }
        ,
        "wk5_r2": {
          "sprint_id": "wk5-demolition-projectiles-workers",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk5_demolition+projectiles_d4ea82e0.plan.md",
            "notes": ""
          },
          "round_id": "wk5_r2",
          "round_meta": {
            "prompt_set_id": "wk5_pm_synthesis_r2_v1",
            "build_target": "BuildA_midweek",
            "sent_at_local": "2026-01-03T09:39:12-07:00"
          },
          "prompt_text": "WK5 R2: Confirm ranged attacker inventory for 'generic pipeline' (at minimum: Ranger + SkeletonArcher + BallistaTower). Lock projectile defaults (speed/lifetime clamp, arrow vs bolt defaults). Confirm demolish guardrails locked: allow under attack, disable under construction.",
          "response": {
            "received_at_local": "2026-01-03T09:39:12-07:00",
            "status": "complete",
            "raw": "### Status\\nAgent 05 (GameplaySystemsDesigner) — WK5 R2 confirmation and lock decisions for ranged attacker inventory, projectile defaults, and demolish guardrails. All decisions are locked for Build A implementation.\\n\\n### Deliverables\\n- **Ranged attacker inventory (locked)**: Confirmed minimum set for generic pipeline (Ranger + SkeletonArcher + BallistaTower).\\n- **Projectile defaults (locked)**: Speed, lifetime clamp, arrow vs bolt defaults finalized for Build A.\\n- **Demolish guardrails (locked)**: Confirmed allow under attack, disable under construction.\\n\\n### Ranged Attacker Inventory (Locked for Build A)\\n\\n**Confirmed minimum set for generic pipeline**:\\n- **Ranger** (hero class): `hero_class == \"ranger\"` OR `is_ranged_attacker == True`\\n- **SkeletonArcher** (enemy type): `enemy_type == \"skeleton_archer\"` OR `is_ranged_attacker == True`\\n- **BallistaTower** (building): `building_type == \"ballista_tower\"` OR `is_ranged_attacker == True`\\n\\n**Implementation contract**: All three must emit `ranged_projectile` events when attacking. The generic pipeline should handle any future ranged attackers that set `is_ranged_attacker == True` or match class/type checks.\\n\\n**Future-proofing**: The pipeline is designed to scale to additional ranged attackers (e.g., wizard spells, future enemy types) without requiring combat system changes—only the attacker needs to set `is_ranged_attacker == True` and optionally implement `get_ranged_spec()`.\\n\\n### Projectile Defaults (Locked for Build A)\\n\\n**Speed (constant)**:\\n- **3000 px/s** (locked)\\n- Rationale: Fast enough to feel responsive, slow enough to be visible at 32×32 scale.\\n\\n**Lifetime (distance-based, clamped)**:\\n- **Formula**: `lifetime_ms = (distance_px / 3000.0) * 1000`\\n- **Clamp**: `min(80ms, max(140ms, lifetime_ms))`\\n- **Rationale**: Ensures projectiles are always visible (≥80ms) but never feel laggy (≤140ms).\\n\\n**Arrow defaults (Ranger + SkeletonArcher)**:\\n- **Projectile kind**: `\"arrow\"`\\n- **Color**: `(200, 200, 50)` yellow-amber (locked)\\n- **Outline**: `(100, 100, 20)` dark amber (locked)\\n- **Size**: `2 px` (locked)\\n- **Rationale**: Yellow-amber reads as \"arrow\" at 32×32; 2 px is visible without overwhelming sprites.\\n\\n**Bolt defaults (BallistaTower)**:\\n- **Projectile kind**: `\"bolt\"`\\n- **Color**: `(180, 180, 200)` light gray-blue (locked)\\n- **Outline**: `(80, 80, 100)` dark gray-blue (locked)\\n- **Size**: `3 px` (locked)\\n- **Rationale**: Gray-blue reads as \"mechanical bolt\"; 3 px feels heavier than arrows.\\n\\n**Determinism requirement (locked)**: All projectile parameters must be derived from event fields (attacker type, from/to positions) or seeded RNG (never wall-clock time).\\n\\n### Demolish Guardrails (Locked for Build A)\\n\\n**Player demolish (locked)**:\\n- **Allowed**: Constructed buildings (`is_constructed == True`) including:\\n  - Buildings under attack (no restriction)\\n  - Buildings with heroes inside (with warning message)\\n- **Disabled**:\\n  - Castle (`building_type == \"castle\"`)\\n  - Under-construction buildings (`is_constructed == False` OR `construction_started == False`)\\n\\n**Auto-demolish (locked)**:\\n- **Triggers**: All non-castle buildings when `hp <= 0`\\n- **No refund**: Auto-demolish does not refund gold (same as player demolish)\\n- **Reference cleanup**: Engine must clear all references before removal (hero.target, enemy.target, peasant.target_building, selected_building, lair_system.lairs, bounties targeting lairs/buildings, hero.home_building)\\n\\n**UX (locked for Build A)**:\\n- **Instant demolish**: No confirmation dialog (fast iteration, low friction)\\n- **Warning message**: If demolishing building with heroes inside: \"Demolished: [Building Name]. Heroes inside have been ejected.\"\\n- **Build B consideration**: Optional confirmation or hold-to-demolish if misclicks observed during playtest\\n\\n### Acceptance Criteria (Locked)\\n- Generic pipeline handles Ranger + SkeletonArcher + BallistaTower (minimum set).\\n- Projectiles use locked defaults: speed 3000 px/s, lifetime 80–140ms clamp, arrow (yellow-amber, 2px) vs bolt (gray-blue, 3px).\\n- Player demolish works for all constructed non-castle buildings (including under attack).\\n- Player demolish disabled for castle and under-construction buildings.\\n- Auto-demolish triggers at 0 HP for all non-castle buildings with proper reference cleanup.\\n- No refunds on demolish (player or auto).\\n\\n### Risks + Mitigations (No Changes)\\n- **Projectile readability**: High-contrast colors (yellow-amber with dark outline) and 2–3 px size (locked).\\n- **Projectile lag**: Constant speed 3000 px/s + distance-based lifetime with 80–140ms clamp (locked).\\n- **Accidental demolish**: Build A instant (low friction) + Build B optional confirmation if misclicks observed (locked).\\n- **Reference cleanup**: Centralized cleanup pass checking all known reference types (locked).\\n\\n### Dependencies (No Blockers)\\n- **Agent 03**: Architecture for `is_ranged_attacker` interface and `get_ranged_spec()` method signature (expected in wk5_r2).\\n- **Agent 08**: Final demolish button UX spec and microcopy (expected in wk5_r2).\\n- **Agent 09**: Art confirmation for arrow color (ranger + skeleton_archer same vs different) and bow readability pixels (expected in wk5_r2).\\n- **Agent 11**: Build A test steps with locked guardrails (expected in wk5_r2).\\n\\n### Questions (Blockers Only)\\n- None. All decisions are locked and ready for Build A implementation.\\n\\n### Recommended Next Actions\\n- Agent 03: Finalize `is_ranged_attacker` interface and `get_ranged_spec()` method signature.\\n- Agent 08: Confirm final demolish button UX spec and microcopy strings.\\n- Agent 09: Confirm arrow color (same for ranger + skeleton_archer recommended) and bow readability pixels.\\n- Implementation: Wire ranged attacker detection in combat system and emit `ranged_projectile` events for Ranger + SkeletonArcher + BallistaTower.\\n- Implementation: Add demolish button to building panel and engine action handler with locked guardrails.\\n- QA: Execute Build A test steps with locked guardrails (demolish edge cases, projectile visibility).",
            "summary_bullets": [
              "Confirmed ranged attacker inventory (locked): Ranger + SkeletonArcher + BallistaTower minimum set for generic pipeline.",
              "Locked projectile defaults: speed 3000 px/s constant, lifetime 80–140ms clamp (distance-based), arrow (yellow-amber, 2px) vs bolt (gray-blue, 3px).",
              "Confirmed demolish guardrails (locked): allow under attack, disable under construction, no refunds, proper reference cleanup."
            ],
            "proposed_changes": [
              "Implement `is_ranged_attacker` boolean property for Ranger, SkeletonArcher, and BallistaTower.",
              "Implement `get_ranged_spec()` method returning projectile metadata (kind, color, size) for VFX system.",
              "Emit `ranged_projectile` events in combat system when `is_ranged_attacker == True` (Ranger + SkeletonArcher + BallistaTower).",
              "Add demolish button to building panel (disabled for castle and under-construction buildings).",
              "Implement auto-demolish cleanup pass in engine (0 HP removal with reference cleanup for all known reference types)."
            ],
            "acceptance_criteria": [
              "Generic pipeline handles Ranger + SkeletonArcher + BallistaTower (minimum set).",
              "Projectiles use locked defaults: speed 3000 px/s, lifetime 80–140ms clamp, arrow (yellow-amber, 2px) vs bolt (gray-blue, 3px).",
              "Player demolish works for all constructed non-castle buildings (including under attack).",
              "Player demolish disabled for castle and under-construction buildings.",
              "Auto-demolish triggers at 0 HP for all non-castle buildings with proper reference cleanup.",
              "No refunds on demolish (player or auto)."
            ],
            "risks": [
              "Projectile readability at 32×32 scale (mitigated with high-contrast colors and 2–3 px size, locked).",
              "Projectile feels laggy if too slow (mitigated with constant speed 3000 px/s and distance-based lifetime with 80–140ms clamp, locked).",
              "Player accidentally demolishes important building (mitigated with Build A instant + Build B optional confirmation if misclicks observed, locked).",
              "Reference cleanup misses edge cases (mitigated with centralized cleanup pass checking all known reference types, locked)."
            ],
            "dependencies": [
              "Agent 03: Finalize `is_ranged_attacker` interface and `get_ranged_spec()` method signature (expected in wk5_r2).",
              "Agent 08: Confirm final demolish button UX spec and microcopy strings (expected in wk5_r2).",
              "Agent 09: Confirm arrow color (same for ranger + skeleton_archer recommended) and bow readability pixels (expected in wk5_r2).",
              "Agent 11: Build A test steps with locked guardrails (expected in wk5_r2)."
            ],
            "questions_back_to_pm": [],
            "recommended_next_actions": [
              "Agent 03: Finalize `is_ranged_attacker` interface and `get_ranged_spec()` method signature.",
              "Agent 08: Confirm final demolish button UX spec and microcopy strings.",
              "Agent 09: Confirm arrow color (same for ranger + skeleton_archer recommended) and bow readability pixels.",
              "Implementation: Wire ranged attacker detection in combat system and emit `ranged_projectile` events for Ranger + SkeletonArcher + BallistaTower.",
              "Implementation: Add demolish button to building panel and engine action handler with locked guardrails.",
              "QA: Execute Build A test steps with locked guardrails (demolish edge cases, projectile visibility)."
            ],
            "agent_fields": {
              "ranged_attacker_inventory_locked": {
                "minimum_set": ["Ranger", "SkeletonArcher", "BallistaTower"],
                "implementation_contract": "All three must emit ranged_projectile events when attacking",
                "future_proofing": "Pipeline scales to additional ranged attackers via is_ranged_attacker flag"
              },
              "projectile_defaults_locked": {
                "speed_px_per_s": 3000,
                "lifetime_formula": "lifetime_ms = (distance_px / 3000.0) * 1000",
                "lifetime_clamp": "min(80ms, max(140ms, lifetime_ms))",
                "arrow_defaults": {
                  "projectile_kind": "arrow",
                  "color": "(200, 200, 50)",
                  "outline": "(100, 100, 20)",
                  "size_px": 2
                },
                "bolt_defaults": {
                  "projectile_kind": "bolt",
                  "color": "(180, 180, 200)",
                  "outline": "(80, 80, 100)",
                  "size_px": 3
                },
                "determinism": "All parameters derived from event fields or seeded RNG (never wall-clock)"
              },
              "demolish_guardrails_locked": {
                "player_demolish_allowed": ["constructed buildings", "buildings under attack", "buildings with heroes inside (with warning)"],
                "player_demolish_disabled": ["castle", "under-construction buildings"],
                "auto_demolish": "all non-castle buildings at 0 HP, no refund, proper reference cleanup",
                "reference_cleanup_required": ["hero.target", "enemy.target", "peasant.target_building", "selected_building", "lair_system.lairs", "bounties targeting lairs/buildings", "hero.home_building"],
                "ux_build_a": "instant demolish, no confirmation",
                "warning_message": "Demolished: [Building Name]. Heroes inside have been ejected."
              },
              "build_a_decisions_locked": true
            }
          }
        }
        ,
        "wk5_r3": {
          "sprint_id": "wk5-demolition-projectiles-workers",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk5_demolition+projectiles_d4ea82e0.plan.md",
            "notes": ""
          },
          "round_id": "wk5_r3",
          "round_meta": {
            "prompt_set_id": "wk5_implementation_greenlight_r3_v1",
            "build_target": "BuildA_midweek",
            "sent_at_local": "2026-01-03T09:53:04-07:00"
          },
            "prompt_text": "WK5 R3 Implementation greenlight: Confirm ranged attacker inventory (Ranger, SkeletonArcher, BallistaTower), lock projectile defaults (speed/lifetime clamp, arrow vs bolt), confirm demolish guardrails (allow under attack, disable under construction). Final confirmation: confirm ranged attacker inventory (min: Ranger, SkeletonArcher, BallistaTower) + projectile defaults (speed/lifetime clamp; kinds).",
          "response": {
            "received_at_local": "2026-01-03T09:53:04-07:00",
            "status": "complete",
            "raw": "### Status\\nAgent 05 (GameplaySystemsDesigner) — WK5 R3 implementation greenlight signoff. All gameplay systems decisions are locked and confirmed from wk5_r2. No code changes from Agent 05; providing final confirmation and tuning guidance only.\\n\\n### Deliverables\\n- **Ranged attacker inventory (confirmed)**: Ranger + SkeletonArcher + BallistaTower minimum set for generic pipeline (locked from wk5_r2).\\n- **Projectile defaults (confirmed)**: Speed 3000 px/s, lifetime 80–140ms clamp, arrow (yellow-amber, 2px) vs bolt (gray-blue, 3px) (locked from wk5_r2).\\n- **Demolish guardrails (confirmed)**: Allow under attack, disable under construction, no refunds, proper reference cleanup (locked from wk5_r2).\\n\\n### Ranged Attacker Inventory (Confirmed for Build A)\\n\\n**Minimum set for generic pipeline (locked)**:\\n- **Ranger** (hero class): `hero_class == \"ranger\"` OR `is_ranged_attacker == True`\\n- **SkeletonArcher** (enemy type): `enemy_type == \"skeleton_archer\"` OR `is_ranged_attacker == True`\\n- **BallistaTower** (building): `building_type == \"ballista_tower\"` OR `is_ranged_attacker == True`\\n\\n**Implementation contract**: All three must emit `ranged_projectile` events when attacking. The generic pipeline should handle any future ranged attackers that set `is_ranged_attacker == True` or match class/type checks.\\n\\n**Note**: BallistaTower is listed as \"future\" in the prompt, but it's part of the locked minimum set from wk5_r2. If BallistaTower is not implemented in Build A, that's acceptable (the pipeline will still work for Ranger + SkeletonArcher).\\n\\n### Projectile Defaults (Confirmed for Build A)\\n\\n**Speed (constant, locked)**:\\n- **3000 px/s**\\n- Rationale: Fast enough to feel responsive, slow enough to be visible at 32×32 scale.\\n\\n**Lifetime (distance-based, clamped, locked)**:\\n- **Formula**: `lifetime_ms = (distance_px / 3000.0) * 1000`\\n- **Clamp**: `min(80ms, max(140ms, lifetime_ms))`\\n- **Rationale**: Ensures projectiles are always visible (≥80ms) but never feel laggy (≤140ms).\\n\\n**Arrow defaults (Ranger + SkeletonArcher, locked)**:\\n- **Projectile kind**: `\"arrow\"`\\n- **Color**: `(200, 200, 50)` yellow-amber\\n- **Outline**: `(100, 100, 20)` dark amber\\n- **Size**: `2 px`\\n- **Rationale**: Yellow-amber reads as \"arrow\" at 32×32; 2 px is visible without overwhelming sprites.\\n\\n**Bolt defaults (BallistaTower, locked)**:\\n- **Projectile kind**: `\"bolt\"`\\n- **Color**: `(180, 180, 200)` light gray-blue\\n- **Outline**: `(80, 80, 100)` dark gray-blue\\n- **Size**: `3 px`\\n- **Rationale**: Gray-blue reads as \"mechanical bolt\"; 3 px feels heavier than arrows.\\n\\n**Determinism requirement (locked)**: All projectile parameters must be derived from event fields (attacker type, from/to positions) or seeded RNG (never wall-clock time).\\n\\n**Projectile cap (new from prompt)**: `MAX_ACTIVE_PROJECTILES=50` (configurable in config.py). This is acceptable for Build A; if performance issues arise, we can tune in Build B.\\n\\n### Demolish Guardrails (Confirmed for Build A)\\n\\n**Player demolish (locked)**:\\n- **Allowed**: Constructed buildings (`is_constructed == True`) including:\\n  - Buildings under attack (no restriction)\\n  - Buildings with heroes inside (with warning message)\\n- **Disabled**:\\n  - Castle (`building_type == \"castle\"`)\\n  - Under-construction buildings (`is_constructed == False` OR `construction_started == False`)\\n\\n**Auto-demolish (locked)**:\\n- **Triggers**: All non-castle buildings when `hp <= 0`\\n- **No refund**: Auto-demolish does not refund gold (same as player demolish)\\n- **Reference cleanup**: Engine must clear all references before removal (hero.target, enemy.target, peasant.target_building, selected_building, lair_system.lairs, bounties targeting lairs/buildings, hero.home_building)\\n\\n**UX (locked for Build A)**:\\n- **Instant demolish**: No confirmation dialog (fast iteration, low friction)\\n- **Warning message**: If demolishing building with heroes inside: \"Demolished: [Building Name]. Heroes inside have been ejected.\"\\n- **Build B consideration**: Optional confirmation or hold-to-demolish if misclicks observed during playtest\\n\\n### Files I Will Touch (None — No Code Changes from Agent 05)\\n- No code changes from Agent 05 in wk5_r3. This is a confirmation/signoff round only.\\n- Implementation owners: Agent 03 (architecture/cleanup), Agent 08 (UI), Agent 09 (art), Agent 11 (QA), Agent 12 (tools).\\n\\n### How I Will Test (Review Only)\\n- **Review implementation PRs** for adherence to locked gameplay decisions:\\n  - Ranged attacker detection correctly identifies Ranger + SkeletonArcher (and BallistaTower if implemented)\\n  - Projectile defaults match locked values (speed 3000 px/s, lifetime 80–140ms clamp, arrow vs bolt specs)\\n  - Demolish guardrails match locked rules (allow under attack, disable under construction)\\n- **Manual smoke test** (after implementation):\\n  - Verify projectiles are visible and readable at 32×32 scale\\n  - Verify demolish works for constructed buildings (including under attack)\\n  - Verify demolish is disabled for castle and under-construction buildings\\n  - Verify auto-demolish triggers at 0 HP with proper reference cleanup\\n\\n### Evidence (Commands Run)\\n- **No commands run by Agent 05 in wk5_r3** (review/signoff only).\\n- **Expected evidence from implementation owners**:\\n  - `python tools/qa_smoke.py --quick` (must PASS)\\n  - `python tools/validate_assets.py --strict --check-attribution` (must PASS)\\n  - Visual Snapshot System: `worker_catalog` and `ranged_projectiles` scenarios produce valid snapshots + gallery builds\\n\\n### Risks + Mitigations (No Changes from wk5_r2)\\n- **Projectile readability**: High-contrast colors (yellow-amber with dark outline) and 2–3 px size (locked).\\n- **Projectile lag**: Constant speed 3000 px/s + distance-based lifetime with 80–140ms clamp (locked).\\n- **Accidental demolish**: Build A instant (low friction) + Build B optional confirmation if misclicks observed (locked).\\n- **Reference cleanup**: Centralized cleanup pass checking all known reference types (locked).\\n- **Projectile cap**: MAX_ACTIVE_PROJECTILES=50 is acceptable for Build A; if performance issues arise, tune in Build B.\\n\\n### Dependencies (No Blockers)\\n- **Agent 03**: Architecture for `is_ranged_attacker` interface and `get_ranged_spec()` method signature (expected in wk5_r3).\\n- **Agent 08**: Final demolish button UX spec and microcopy strings (expected in wk5_r3).\\n- **Agent 09**: Art confirmation for arrow color (ranger + skeleton_archer same vs different) and bow readability pixels (expected in wk5_r3).\\n- **Agent 11**: Build A test steps with locked guardrails (expected in wk5_r3).\\n- **Agent 12**: Tools updates (manifest, validator, placeholder generator, snapshot scenarios) (expected in wk5_r3).\\n\\n### Questions (Blockers Only)\\n- None. All decisions are locked and ready for Build A implementation.\\n\\n### Recommended Next Actions\\n- **Agent 03**: Implement building removal + reference cleanup and ranged projectile event contract.\\n- **Agent 08**: Implement demolish button in building panel with locked UX spec.\\n- **Agent 09**: Generate/verify worker placeholder sprites and ensure ranger attack pose includes bow cue.\\n- **Agent 11**: Execute Build A test steps with locked guardrails.\\n- **Agent 12**: Update tools (manifest, validator, placeholder generator, snapshot scenarios).\\n- **After implementation**: Run `python tools/qa_smoke.py --quick` and `python tools/validate_assets.py --strict --check-attribution` to verify gates pass.\\n- **After implementation**: Run Visual Snapshot System scenarios (`worker_catalog` and `ranged_projectiles`) and rebuild gallery.\\n\\n### Signoff\\nAll gameplay systems decisions are locked and confirmed from wk5_r2. No blockers from Agent 05. Ready for Build A implementation.",
            "summary_bullets": [
              "Confirmed ranged attacker inventory (locked): Ranger + SkeletonArcher + BallistaTower minimum set for generic pipeline.",
              "Confirmed projectile defaults (locked): speed 3000 px/s, lifetime 80–140ms clamp, arrow (yellow-amber, 2px) vs bolt (gray-blue, 3px).",
              "Confirmed demolish guardrails (locked): allow under attack, disable under construction, no refunds, proper reference cleanup.",
              "No code changes from Agent 05 in wk5_r3; this is a confirmation/signoff round only."
            ],
            "proposed_changes": [
              "No code changes from Agent 05 in wk5_r3; providing final confirmation and tuning guidance only.",
              "Implementation owners: Agent 03 (architecture/cleanup), Agent 08 (UI), Agent 09 (art), Agent 11 (QA), Agent 12 (tools)."
            ],
            "acceptance_criteria": [
              "Generic pipeline handles Ranger + SkeletonArcher + BallistaTower (minimum set).",
              "Projectiles use locked defaults: speed 3000 px/s, lifetime 80–140ms clamp, arrow (yellow-amber, 2px) vs bolt (gray-blue, 3px).",
              "Player demolish works for all constructed non-castle buildings (including under attack).",
              "Player demolish disabled for castle and under-construction buildings.",
              "Auto-demolish triggers at 0 HP for all non-castle buildings with proper reference cleanup.",
              "No refunds on demolish (player or auto).",
              "Gates PASS: python tools/qa_smoke.py --quick and python tools/validate_assets.py --strict --check-attribution.",
              "Visual Snapshot System: worker_catalog and ranged_projectiles scenarios produce valid snapshots + gallery builds."
            ],
            "risks": [
              "Projectile readability at 32×32 scale (mitigated with high-contrast colors and 2–3 px size, locked).",
              "Projectile feels laggy if too slow (mitigated with constant speed 3000 px/s and distance-based lifetime with 80–140ms clamp, locked).",
              "Player accidentally demolishes important building (mitigated with Build A instant + Build B optional confirmation if misclicks observed, locked).",
              "Reference cleanup misses edge cases (mitigated with centralized cleanup pass checking all known reference types, locked).",
              "Projectile cap performance (MAX_ACTIVE_PROJECTILES=50 acceptable for Build A; tune in Build B if needed)."
            ],
            "dependencies": [
              "Agent 03: Architecture for `is_ranged_attacker` interface and `get_ranged_spec()` method signature (expected in wk5_r3).",
              "Agent 08: Final demolish button UX spec and microcopy strings (expected in wk5_r3).",
              "Agent 09: Art confirmation for arrow color (ranger + skeleton_archer same vs different) and bow readability pixels (expected in wk5_r3).",
              "Agent 11: Build A test steps with locked guardrails (expected in wk5_r3).",
              "Agent 12: Tools updates (manifest, validator, placeholder generator, snapshot scenarios) (expected in wk5_r3)."
            ],
            "questions_back_to_pm": [],
            "recommended_next_actions": [
              "Agent 03: Implement building removal + reference cleanup and ranged projectile event contract.",
              "Agent 08: Implement demolish button in building panel with locked UX spec.",
              "Agent 09: Generate/verify worker placeholder sprites and ensure ranger attack pose includes bow cue.",
              "Agent 11: Execute Build A test steps with locked guardrails.",
              "Agent 12: Update tools (manifest, validator, placeholder generator, snapshot scenarios).",
              "After implementation: Run `python tools/qa_smoke.py --quick` and `python tools/validate_assets.py --strict --check-attribution` to verify gates pass.",
              "After implementation: Run Visual Snapshot System scenarios (`worker_catalog` and `ranged_projectiles`) and rebuild gallery."
            ],
            "agent_fields": {
              "role_in_wk5_r3": "confirmation_signoff_only",
              "code_changes": "none",
              "ranged_attacker_inventory_confirmed": {
                "minimum_set": ["Ranger", "SkeletonArcher", "BallistaTower"],
                "note": "BallistaTower listed as 'future' in prompt but part of locked minimum set from wk5_r2"
              },
              "projectile_defaults_confirmed": {
                "speed_px_per_s": 3000,
                "lifetime_formula": "lifetime_ms = (distance_px / 3000.0) * 1000",
                "lifetime_clamp": "min(80ms, max(140ms, lifetime_ms))",
                "arrow_defaults": {
                  "projectile_kind": "arrow",
                  "color": "(200, 200, 50)",
                  "outline": "(100, 100, 20)",
                  "size_px": 2
                },
                "bolt_defaults": {
                  "projectile_kind": "bolt",
                  "color": "(180, 180, 200)",
                  "outline": "(80, 80, 100)",
                  "size_px": 3
                },
                "max_active_projectiles": 50,
                "determinism": "All parameters derived from event fields or seeded RNG (never wall-clock)"
              },
              "demolish_guardrails_confirmed": {
                "player_demolish_allowed": ["constructed buildings", "buildings under attack", "buildings with heroes inside (with warning)"],
                "player_demolish_disabled": ["castle", "under-construction buildings"],
                "auto_demolish": "all non-castle buildings at 0 HP, no refund, proper reference cleanup",
                "reference_cleanup_required": ["hero.target", "enemy.target", "peasant.target_building", "selected_building", "lair_system.lairs", "bounties targeting lairs/buildings", "hero.home_building"],
                "ux_build_a": "instant demolish, no confirmation",
                "warning_message": "Demolished: [Building Name]. Heroes inside have been ejected."
              },
              "ready_for_implementation": true,
              "no_blockers": true
            }
          }
        }
        ,
        "wk5_r5": {
          "sprint_id": "wk5-demolition-projectiles-workers",
          "sprint_meta": {
            "plan_ref": ".cursor/plans/wk5_demolition+projectiles_d4ea82e0.plan.md",
            "notes": "WK5 R5: Post-ship fix - Replace glyph rendering with pixel sprite rendering for peasants and tax collectors."
          },
          "round_id": "wk5_r5",
          "round_meta": {
            "prompt_set_id": "wk5_worker_sprite_fix_r5_v1",
            "build_target": "BuildA_fix",
            "sent_at_local": "2026-01-03T12:22:17-07:00"
          },
          "prompt_text": "WK5 R5: Replace glyph rendering with pixel sprite rendering for peasants (circle + 'P') and tax collectors (diamond + '$'). Create WorkerSpriteLibrary similar to HeroSpriteLibrary/EnemySpriteLibrary. Load frames from assets/sprites/workers/<worker_type>/<action>/frame_*.png. Map actions: Peasant (idle, walk, work, hurt, dead), TaxCollector (idle, walk, collect, return). Fallback to glyph if frames missing.",
          "response": {
            "received_at_local": "2026-01-03T12:22:17-07:00",
            "status": "complete",
            "raw": "### Status\\nAgent 05 (GameplaySystemsDesigner) — WK5 R5 worker sprite rendering implementation complete. Replaced glyph rendering (circle + 'P' for peasants, diamond + '$' for tax collectors) with pixel sprite rendering using new WorkerSpriteLibrary. All gates pass.\\n\\n### Deliverables\\n- **Created WorkerSpriteLibrary**: New `game/graphics/worker_sprites.py` mirroring HeroSpriteLibrary/EnemySpriteLibrary pattern.\\n- **Updated Peasant rendering**: Replaced circle + 'P' glyph with sprite animation (idle, walk, work, hurt, dead).\\n- **Updated TaxCollector rendering**: Replaced diamond + '$' glyph with sprite animation (idle, walk, collect, return).\\n- **Fallback policy**: If frames are missing, falls back to old glyph render (but prefers sprites when present).\\n\\n### Files Changed\\n- **NEW**: `game/graphics/worker_sprites.py` (WorkerSpriteLibrary class with procedural fallback)\\n- **MODIFIED**: `game/entities/peasant.py` (added sprite animation initialization, update logic, and render path)\\n- **MODIFIED**: `game/entities/tax_collector.py` (added sprite animation update logic and render path)\\n\\n### Before/After\\n- **Before**: Peasants rendered as white-outlined circles with 'P' glyph; tax collectors as white-outlined diamonds with '$' glyph.\\n- **After**: Peasants and tax collectors render as 32×32 pixel sprites (procedural fallback until art assets exist). Sprites animate based on state (idle, walk, work/collect, hurt, dead). Health bar and gold text overlays remain unchanged.\\n\\n### Implementation Details\\n- **WorkerSpriteLibrary**:\\n  - Loads frames from `assets/sprites/workers/<worker_type>/<action>/frame_*.png`\\n  - Falls back to procedural frames (simple circle + head sprites) if assets missing\\n  - Supports peasant (idle, walk, work, hurt, dead) and tax_collector (idle, walk, collect, return)\\n  - Uses same caching pattern as hero/enemy sprite libraries\\n- **Peasant updates**:\\n  - Initialize `_anim` in `__init__` using `WorkerSpriteLibrary.create_player(\"peasant\", size=32)`\\n  - Added `_update_animation(dt)` method that maps `PeasantState` to animation clips (MOVING→walk, WORKING→work, DEAD→dead, etc.)\\n  - Updated `render()` to blit sprite frame instead of drawing circle + 'P' glyph\\n  - Added hurt animation trigger in `take_damage()`\\n- **TaxCollector updates**:\\n  - Initialize `_anim` in `__init__` using `WorkerSpriteLibrary.create_player(\"tax_collector\", size=32)`\\n  - Added `_update_animation(dt)` method that maps `CollectorState` to animation clips (MOVING_TO_GUILD→walk, COLLECTING→collect, RETURNING→return, WAITING→idle)\\n  - Updated `render()` to blit sprite frame instead of drawing diamond + '$' glyph\\n  - Gold text overlay and state indicator text remain unchanged (per requirements)\\n\\n### How to Test\\n- **Manual**: Launch game (`python main.py --no-llm`) and observe peasants/tax collectors render as sprites (not glyphs)\\n- **Gates**:\\n  - `python tools/qa_smoke.py --quick` → PASS (exit_code=0)\\n  - `python tools/validate_assets.py --strict --check-attribution` → PASS (exit_code=0)\\n- **Visual Snapshot**: Run `worker_catalog` scenario to verify sprites are visible (not glyphs)\\n\\n### Evidence (Commands Run)\\n- **qa_smoke --quick**: PASS\\n  - determinism_guard: PASS (no violations)\\n  - All scenarios: PASS (default, intent_bounty, hero_stuck_repro, no-enemies, mock-LLM)\\n  - Exit code: 0\\n- **validate_assets --strict --check-attribution**: PASS\\n  - Exit code: 0\\n  - No errors reported\\n\\n### Risks + Mitigations\\n- **Risk: Missing sprite frames cause crashes**: Mitigated with fallback to glyph render if `_anim` is None or frame() fails.\\n- **Risk: Animation state mapping incorrect**: Mitigated by testing state transitions (MOVING→walk, WORKING→work, etc.) and verifying animation clips exist.\\n- **Risk: Performance regression**: Mitigated by using same caching pattern as hero/enemy sprite libraries (frames cached per worker_type + size).\\n\\n### Dependencies (No Blockers)\\n- **Agent 12**: Worker sprites should exist at `assets/sprites/workers/peasant/` and `assets/sprites/workers/tax_collector/` (placeholder generator should create them).\\n- **Agent 11**: Visual Snapshot System `worker_catalog` scenario should verify sprites are visible (not glyphs).\\n\\n### Questions (Blockers Only)\\n- None.\\n\\n### Recommended Next Actions\\n- **Agent 12**: Verify placeholder generator creates worker sprite frames at expected paths.\\n- **Agent 11**: Run `worker_catalog` snapshot scenario to verify sprites are visible (not glyphs).\\n- **Manual smoke**: Launch game and verify peasants/tax collectors render as sprites (procedural fallback is acceptable until art assets exist).",
            "summary_bullets": [
              "Created WorkerSpriteLibrary (game/graphics/worker_sprites.py) mirroring HeroSpriteLibrary/EnemySpriteLibrary pattern.",
              "Updated Peasant rendering: replaced circle + 'P' glyph with sprite animation (idle, walk, work, hurt, dead).",
              "Updated TaxCollector rendering: replaced diamond + '$' glyph with sprite animation (idle, walk, collect, return).",
              "Fallback policy: if frames missing, falls back to old glyph render (but prefers sprites when present).",
              "All gates pass: qa_smoke --quick PASS, validate_assets --strict --check-attribution PASS."
            ],
            "proposed_changes": [
              "NEW: game/graphics/worker_sprites.py (WorkerSpriteLibrary class with procedural fallback for peasant and tax_collector).",
              "MODIFIED: game/entities/peasant.py (added sprite animation initialization, _update_animation() method, and updated render() to use sprites).",
              "MODIFIED: game/entities/tax_collector.py (added sprite animation initialization, _update_animation() method, and updated render() to use sprites)."
            ],
            "acceptance_criteria": [
              "Peasants no longer show 'P' circles; render as pixel sprites (procedural fallback acceptable until art assets exist).",
              "Tax collectors no longer show '$' diamonds; render as pixel sprites (procedural fallback acceptable until art assets exist).",
              "python tools/qa_smoke.py --quick stays PASS.",
              "python tools/validate_assets.py --strict --check-attribution stays PASS.",
              "worker_catalog snapshot clearly shows sprite workers, not glyphs (when available)."
            ],
            "risks": [
              "Missing sprite frames cause crashes (mitigated with fallback to glyph render if _anim is None or frame() fails).",
              "Animation state mapping incorrect (mitigated by testing state transitions and verifying animation clips exist).",
              "Performance regression (mitigated by using same caching pattern as hero/enemy sprite libraries)."
            ],
            "dependencies": [
              "Agent 12: Worker sprites should exist at assets/sprites/workers/peasant/ and assets/sprites/workers/tax_collector/ (placeholder generator should create them).",
              "Agent 11: Visual Snapshot System worker_catalog scenario should verify sprites are visible (not glyphs)."
            ],
            "questions_back_to_pm": [],
            "recommended_next_actions": [
              "Agent 12: Verify placeholder generator creates worker sprite frames at expected paths.",
              "Agent 11: Run worker_catalog snapshot scenario to verify sprites are visible (not glyphs).",
              "Manual smoke: Launch game and verify peasants/tax collectors render as sprites (procedural fallback is acceptable until art assets exist)."
            ],
            "agent_fields": {
              "files_changed": [
                "game/graphics/worker_sprites.py (NEW)",
                "game/entities/peasant.py (MODIFIED)",
                "game/entities/tax_collector.py (MODIFIED)"
              ],
              "before_after": {
                "before": "Peasants: white-outlined circles with 'P' glyph. Tax collectors: white-outlined diamonds with '$' glyph.",
                "after": "Peasants and tax collectors render as 32×32 pixel sprites (procedural fallback until art assets exist). Sprites animate based on state."
              },
              "qa_smoke_quick": "PASS",
              "qa_smoke_exit_code": 0,
              "validate_assets": "PASS",
              "validate_assets_exit_code": 0,
              "implementation_complete": true,
              "ready_for_integration": true
            }
          }
        }
      }
    }
  }
}

